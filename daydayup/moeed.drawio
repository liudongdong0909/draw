<mxfile host="app.diagrams.net" modified="2020-09-29T09:16:50.488Z" agent="5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36" etag="RgXDaO-PCaAtxXIx7Ys_" version="13.7.6" type="github" pages="3">
  <diagram id="S3pzfacEeb6MH5ZYZH9_" name="volatile">
    <mxGraphModel dx="1899" dy="1043" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-0" />
        <mxCell id="-h0pTx25_JJzhhGNy_4A-1" parent="-h0pTx25_JJzhhGNy_4A-0" />
        <mxCell id="-h0pTx25_JJzhhGNy_4A-21" value="修改 data 值为1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="360" y="210" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-22" value="强制刷新 主内存&amp;nbsp;&lt;br&gt;data 由&amp;nbsp; &amp;nbsp; 0 --&amp;gt; 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="359" y="300" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-2" value="主内存" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="360" y="370" width="120" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-3" value="线程A" style="whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#ffffff;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="195" y="140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-4" value="线程B" style="whiteSpace=wrap;html=1;fillColor=#f0a30a;strokeColor=#BD7000;fontColor=#ffffff;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="570" y="140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-6" target="-h0pTx25_JJzhhGNy_4A-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-6" value="工作内存" style="whiteSpace=wrap;html=1;fillColor=#a0522d;strokeColor=#6D1F00;fontColor=#ffffff;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="150" y="260" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-7" target="-h0pTx25_JJzhhGNy_4A-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-7" value="工作内存" style="whiteSpace=wrap;html=1;fillColor=#76608a;strokeColor=#432D57;fontColor=#ffffff;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="520" y="260" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-9" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-2" target="-h0pTx25_JJzhhGNy_4A-7" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="360" as="sourcePoint" />
            <mxPoint x="470" y="310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="350" />
              <mxPoint x="630" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-10" value="" style="endArrow=classic;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="-h0pTx25_JJzhhGNy_4A-1" target="-h0pTx25_JJzhhGNy_4A-6" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="370" as="sourcePoint" />
            <mxPoint x="290" y="330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="350" />
              <mxPoint x="255" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-11" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-6" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="430" y="310" as="sourcePoint" />
            <mxPoint x="420" y="370" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-14" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-3" target="-h0pTx25_JJzhhGNy_4A-6" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="220" as="sourcePoint" />
            <mxPoint x="420" y="170" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="170" />
              <mxPoint x="420" y="275" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-15" value="data = 0(强制过期)&amp;nbsp; &amp;nbsp;--&amp;gt;&amp;nbsp; &amp;nbsp;data = 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#dae8fc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="540" y="300" width="190" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="414" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-16" value="data = 0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#dae8fc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="384" y="460" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-17" value="data = 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="384" y="500" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-20" value="data = 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#dae8fc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="270" y="300" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-24" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;data变量定义的时候前面加了volatile来修饰的话，那么线程1只要修改data变量的值，&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;就会在&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(201 , 56 , 28) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;修改完自己本地工作内存的data变量值之后，强制将这个data变量最新的值刷回主内存&lt;/span&gt;，&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;必须让主内存里的data变量值立马变成最新的值！&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#fff2cc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="90" y="590" width="750" height="110" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-26" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;线程B在代码运行过程中再次需要读取data变量的值，此时尝试从本地工作内存中读取，就会发现这个data = 0已经过期了！&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时，他就必须重新从主内存中加载data变量最新的值！那么不就可以读取到data = 1这个最新的值了！&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#fff2cc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="760" y="140" width="970" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-27" value="" style="endArrow=classic;html=1;exitX=-0.007;exitY=0.491;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;strokeWidth=2;strokeColor=#FF0080;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-24" target="-h0pTx25_JJzhhGNy_4A-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="480" as="sourcePoint" />
            <mxPoint x="140" y="430" as="targetPoint" />
            <Array as="points">
              <mxPoint x="50" y="644" />
              <mxPoint x="50" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-29" value="&lt;span style=&quot;background-color: rgb(255 , 242 , 204)&quot;&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时别的线程的工作内存中有这个data变量的本地缓存，也就是一个变量副本的话，&lt;br&gt;那么会&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; font-size: 15px ; letter-spacing: 2px ; color: rgb(201 , 56 , 28) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;强制让其他线程的工作内存中的data变量缓存直接失效过期&lt;/span&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px&quot;&gt;，不允许再次读取和使用了！&lt;/span&gt;&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#fff2cc;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="760" y="380" width="730" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-30" value="" style="endArrow=classic;html=1;dashed=1;strokeColor=#FF0080;strokeWidth=2;" parent="-h0pTx25_JJzhhGNy_4A-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="750" y="400" as="sourcePoint" />
            <mxPoint x="637" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="637" y="400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-31" value="" style="endArrow=classic;html=1;dashed=1;strokeColor=#FF0080;strokeWidth=2;exitX=0.451;exitY=1.025;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;" parent="-h0pTx25_JJzhhGNy_4A-1" source="-h0pTx25_JJzhhGNy_4A-26" target="-h0pTx25_JJzhhGNy_4A-15" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="330" as="sourcePoint" />
            <mxPoint x="810" y="280" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1197" y="311" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-h0pTx25_JJzhhGNy_4A-32" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;volatile完美解决了java并发中可见性的问题！&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;对一个变量加了volatile关键字修饰之后，只要一个线程修改了这个变量的值，立马强制刷回主内存。&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;接着强制过期其他线程的本地工作内存中的缓存，最后其他线程读取变量值的时候，强制重新从主内存来加载最新的值！&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 19px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 19px&quot;&gt;这样就保证，任何一个线程修改了变量值，其他线程立马就可以看见了！这就是所谓的volatile保证了可见性的工作原理！&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;" parent="-h0pTx25_JJzhhGNy_4A-1" vertex="1">
          <mxGeometry x="200" y="790" width="1160" height="270" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="KYmmCUVDvo8mrhyJnLTW" name="CAS">
    <mxGraphModel dx="1899" dy="1043" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="OxfkeTKddjhHw0AheIVP-0" />
        <mxCell id="OxfkeTKddjhHw0AheIVP-1" parent="OxfkeTKddjhHw0AheIVP-0" />
        <mxCell id="01sIQlWdCzxstv_JN03J-0" value="&lt;b&gt;&lt;font style=&quot;font-size: 22px&quot;&gt;JAVA8 如何优化CAS性能&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="670" y="30" width="270" height="20" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-1" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;quot;meslo lg m dz for powerline&amp;quot; , monospace ; font-size: 12.0pt&quot;&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;/**&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Author &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;walle&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Date &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;2020-09-27&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Version &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;1.0.0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public class &lt;/span&gt;HelloCAS &lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;private  int &lt;/span&gt;&lt;span style=&quot;color: #9876aa&quot;&gt;data &lt;/span&gt;= &lt;span style=&quot;color: #6897bb&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    public synchronized void &lt;/span&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;increment&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;(){&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9876aa&quot;&gt;data &lt;/span&gt;++&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-family: &amp;quot;menlo-regular&amp;quot; , monospace&quot;&gt;多线程调用&lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt; increment()&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="640" y="130" width="410" height="250" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-2" value="&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 16px ; letter-spacing: 2px ; background-color: rgb(230 , 230 , 230)&quot;&gt;多个线程直接这样并发的对一个data变量进行修改，&lt;br&gt;是线程不安全性的行为，会导致data值的变化不遵照预期的值来改变。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#f5f5f5;fontColor=#333333;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="460" width="580" height="40" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-3" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 12.0pt&quot;&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;/**&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Author &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;walle&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Date &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;2020-09-27&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Version &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;1.0.0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public class &lt;/span&gt;HelloCAS &lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;private  int &lt;/span&gt;&lt;span style=&quot;color: #9876aa&quot;&gt;data &lt;/span&gt;= &lt;span style=&quot;color: #6897bb&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    public void &lt;/span&gt;&lt;span style=&quot;color: #ffc66d&quot;&gt;increment&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;(){&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9876aa&quot;&gt;data &lt;/span&gt;++&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-family: &amp;#34;menlo-regular&amp;#34; , monospace&quot;&gt;多线程调用&lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt; increment()&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="140" width="290" height="250" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-4" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;这个时候，代码就是线程安全的了，因为我们加了&lt;/span&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;synchronized&lt;/strong&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;，&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;也就是让每个线程要进入increment()方法之前先得尝试加锁，同一时间只有一个线程能加锁，其他线程需要等待锁。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;通过这样处理，就可以保证换个data每次都会累加1，不会出现数据错乱的问题。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#d5e8d4;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="720" y="425" width="910" height="110" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-5" value="" style="endArrow=classic;html=1;dashed=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;entryX=1.002;entryY=0.468;entryDx=0;entryDy=0;entryPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" target="01sIQlWdCzxstv_JN03J-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1200" y="420" as="sourcePoint" />
            <mxPoint x="760" y="810" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1200" y="247" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-6" value="&lt;span style=&quot;color: rgb(51 , 51 , 51) ; letter-spacing: 2px ; text-align: justify ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;感受一下synchronized加锁下的效果和氛围，相当于N个线程一个一个的排队在更新那个数值。&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="150" y="660" width="790" height="20" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-10" target="01sIQlWdCzxstv_JN03J-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-10" value="线程3" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontSize=16;align=center;strokeColor=#666666;fontColor=#333333;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="155" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-13" target="01sIQlWdCzxstv_JN03J-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-13" value="线程2" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontSize=16;align=center;strokeColor=#666666;fontColor=#333333;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="355" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-15" target="01sIQlWdCzxstv_JN03J-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-15" value="线程1" style="whiteSpace=wrap;html=1;fillColor=#f5f5f5;fontSize=16;align=center;strokeColor=#666666;fontColor=#333333;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="555" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-17" target="01sIQlWdCzxstv_JN03J-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-17" value="synchronized&lt;br&gt;加锁" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;fontSize=16;align=center;strokeColor=#b85450;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="755" y="720" width="120" height="140" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=16;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-19" target="01sIQlWdCzxstv_JN03J-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-19" value="data ++" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;fontSize=16;align=center;strokeColor=#6c8ebf;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="955" y="755" width="110" height="70" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-21" value="synchronized&lt;br&gt;释放锁" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;fontSize=16;align=center;strokeColor=#b85450;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="1145" y="720" width="110" height="140" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-23" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;synchronized是可以解决更加复杂的并发编程场景和问题的。&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;而且，在这个场景下，你要是用synchronized，不就相当于让各个线程串行化了么？一个接一个的排队，加锁，处理数据，释放锁，下一个再进来。&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#f5f5f5;fontColor=#333333;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="920" width="1160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-24" value="更加高效的方案： Atomic原子类" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontStyle=1" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="1090" width="340" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-25" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;dashed=1;" parent="OxfkeTKddjhHw0AheIVP-1" target="01sIQlWdCzxstv_JN03J-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="301" y="457" as="sourcePoint" />
            <mxPoint x="330" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-28" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 12.0pt&quot;&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;/**&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Author &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;walle&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Date &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;2020-09-27&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; * &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-weight: bold ; font-style: italic&quot;&gt;@Version &lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt;1.0.0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #629755 ; font-style: italic&quot;&gt; */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;public class &lt;/span&gt;HelloCAS &lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;private &lt;/span&gt;AtomicInteger &lt;span style=&quot;color: #9876aa&quot;&gt;data &lt;/span&gt;= &lt;span style=&quot;color: #cc7832&quot;&gt;new &lt;/span&gt;AtomicInteger&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #6897bb&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-family: &amp;#34;menlo-regular&amp;#34; , monospace&quot;&gt;多线程调用&lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt; data.incrementAndGet();&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;fontSize=22;align=left;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="110" y="1150" width="520" height="210" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-29" value="&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(201, 56, 28); font-size: 19px; letter-spacing: 2px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;Atomic原子类底层用的不是传统意义的锁机制，&lt;br style=&quot;font-size: 19px;&quot;&gt;而是无锁化的CAS机制，通过CAS机制保证多线程修改一个数值的安全性&lt;/strong&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=19;fontStyle=1" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="675" y="1240" width="700" height="50" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-31" value="&lt;pre style=&quot;color: rgb(169 , 183 , 198) ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 12pt&quot;&gt;&lt;br&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=19;align=left;strokeColor=none;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="325" y="1840" width="205" height="190" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-32" value="线程A" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;fontSize=18;align=center;strokeColor=#6c8ebf;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="1560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-33" value="线程B" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;fontSize=18;align=center;strokeColor=#d6b656;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="367.5" y="1560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-34" value="线程C" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;fontSize=18;align=center;strokeColor=#b85450;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="650" y="1560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-35" value="&lt;span style=&quot;font-size: 22px; letter-spacing: 2px; text-align: justify; background-color: rgb(255, 255, 255);&quot;&gt;3个线程并发的要修改一个&lt;/span&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; font-size: 22px; text-align: justify; letter-spacing: 0.5px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;AtomicInteger&lt;/span&gt;&lt;span style=&quot;font-size: 22px; letter-spacing: 2px; text-align: justify; background-color: rgb(255, 255, 255);&quot;&gt;的值，他们底层的机制如下：&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontStyle=1;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="1440" width="760" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-36" value="&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px ; background-color: rgb(255 , 255 , 255)&quot;&gt;1. 每个线程都会先获取当前的值，接着走一个原子的CAS操作，&lt;br&gt;原子的意思就是这个CAS操作一定是自己完整执行完的，不会被别人打断。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="200" y="1470" width="580" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-37" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=-0.02;exitY=0.342;exitDx=0;exitDy=0;exitPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-31" target="01sIQlWdCzxstv_JN03J-32" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="1910" as="sourcePoint" />
            <mxPoint x="120" y="1650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="140" y="1905" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-38" value="&lt;font style=&quot;font-size: 16px&quot;&gt;先拿到当前值0&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="20" y="1694" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-39" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-32" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="1710" as="sourcePoint" />
            <mxPoint x="320" y="1880" as="targetPoint" />
            <Array as="points">
              <mxPoint x="170" y="1880" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-40" value="&amp;nbsp;&lt;font style=&quot;font-size: 16px&quot;&gt;CAS&lt;br&gt;你现在还是0吗？&lt;br&gt;如果是，设置为1&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="1655" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-42" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-31" target="01sIQlWdCzxstv_JN03J-33" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="1740" as="sourcePoint" />
            <mxPoint x="440" y="1690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-43" value="&lt;font style=&quot;font-size: 16px&quot;&gt;先拿到当前值1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="310" y="1685" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-44" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.659;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-33" target="01sIQlWdCzxstv_JN03J-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="1730" as="sourcePoint" />
            <mxPoint x="520" y="1680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-45" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;CAS&lt;br&gt;&lt;/font&gt;你现在还是1吗？&lt;br&gt;如果是，设置为2&amp;nbsp;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="460" y="1664" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-47" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=1;exitY=0.216;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-31" target="01sIQlWdCzxstv_JN03J-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="710" y="1800" as="sourcePoint" />
            <mxPoint x="760" y="1750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="710" y="1881" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-48" value="&lt;font style=&quot;font-size: 16px&quot; color=&quot;#cc6600&quot;&gt;先拿到当前值1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="590" y="1685" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-49" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.692;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="750" y="1780" as="sourcePoint" />
            <mxPoint x="532" y="1905" as="targetPoint" />
            <Array as="points">
              <mxPoint x="733" y="1905" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-50" value="&lt;font style=&quot;font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;font color=&quot;#cc6600&quot;&gt;CAS&lt;br&gt;你现在还是1吗？&lt;br&gt;不是！CAS失败&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="735" y="1655" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-51" value="" style="endArrow=none;html=1;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.99;entryY=0.537;entryDx=0;entryDy=0;startArrow=classic;startFill=1;endFill=0;strokeColor=#FF00FF;entryPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-34" target="01sIQlWdCzxstv_JN03J-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="960" y="1830" as="sourcePoint" />
            <mxPoint x="1010" y="1780" as="targetPoint" />
            <Array as="points">
              <mxPoint x="870" y="1590" />
              <mxPoint x="870" y="1942" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-52" value="&lt;font style=&quot;font-size: 16px&quot; color=&quot;#ff00ff&quot;&gt;再次拿到当前值2&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="800" y="1634" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-53" value="" style="endArrow=classic;html=1;strokeColor=#FF00FF;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1.01;entryY=0.642;entryDx=0;entryDy=0;entryPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-34" target="01sIQlWdCzxstv_JN03J-31" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1000" y="1780" as="sourcePoint" />
            <mxPoint x="1050" y="1730" as="targetPoint" />
            <Array as="points">
              <mxPoint x="950" y="1575" />
              <mxPoint x="950" y="1962" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-54" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;color: rgb(255 , 0 , 255) ; font-size: 16px&quot;&gt;CAS&lt;/span&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;color: rgb(255 , 0 , 255)&quot;&gt;你现在时还是2吗？&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;#ff00ff&quot;&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;是的！设置为3&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="950" y="1664" width="150" height="90" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-55" value="&lt;pre style=&quot;text-align: left ; color: rgb(169 , 183 , 198) ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 13px&quot;&gt;&lt;span style=&quot;color: rgb(204 , 120 , 50)&quot;&gt;new &lt;/span&gt;AtomicInteger&lt;span style=&quot;color: rgb(152 , 118 , 170) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(104 , 151 , 187)&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(152 , 118 , 170) ; font-style: italic&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="342.5" y="1850" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-56" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 14px&quot;&gt;&lt;font color=&quot;#a9b7c6&quot; style=&quot;font-size: 14px&quot;&gt;AtomicInteger&lt;/font&gt;&lt;span style=&quot;color: rgb(152 , 118 , 170) ; font-style: italic&quot;&gt;(&lt;/span&gt;&lt;font color=&quot;#6897bb&quot; style=&quot;font-size: 14px&quot;&gt;3&lt;/font&gt;&lt;span style=&quot;color: rgb(152 , 118 , 170) ; font-style: italic&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fillColor=#f8cecc;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="352.5" y="1960" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-57" value="" style="endArrow=classic;html=1;strokeColor=#FF00FF;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.497;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;dashed=1;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-55" target="01sIQlWdCzxstv_JN03J-56" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="620" y="2120" as="sourcePoint" />
            <mxPoint x="670" y="2070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-59" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;上述整个过程，就是所谓Atomic原子类的原理，没有基于加锁机制串行化，&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;而是基于CAS机制：&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;先获取一个值，然后发起CAS，比较这个值被人改过没？如果没有，就更改值！这个CAS是原子的，别人不会打断你！&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;通过这个机制，不需要加锁这么重量级的机制，也可以用轻量级的方式实现多个线程安全的并发的修改某个数值。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#333333;fillColor=#f5f5f5;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="2080" width="1080" height="110" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-60" value="&lt;font&gt;存在的问题&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontStyle=1;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="2290" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-61" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 18px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 18px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;比如说大量的线程同时并发修改一个AtomicInteger，可能有&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 18px;&quot;&gt;很多线程会不停的自旋&lt;/strong&gt;，进入一个无限重复的循环中。&lt;/font&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 18px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;这些线程不停地获取值，然后发起CAS操作，但是发现这个值被别人改过了，于是再次进入下一个循环，获取值，发起CAS操作又失败了，再次进入下一个循环。&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 18px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;在大量线程高并发更新AtomicInteger的时候，这种问题可能会比较明显，导致大量线程空循环，自旋转，性能和效率都不是特别好&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fontColor=#333333;fillColor=#f5f5f5;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="2330" width="1460" height="110" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-62" value="&lt;font style=&quot;font-size: 22px&quot;&gt;&lt;b&gt;优化方案：&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fontColor=#FF0000;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="80" y="2490" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-63" value="&lt;font style=&quot;background-color: rgb(230 , 230 , 230) ; font-size: 16px&quot;&gt;&lt;strong style=&quot;color: rgb(0 , 0 , 0) ; margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 2px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;LongAdder&lt;/strong&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; letter-spacing: 2px ; text-align: justify&quot;&gt;，他就是尝试使用&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 2px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;分段CAS&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; letter-spacing: 2px ; text-align: justify&quot;&gt;以及&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 2px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;自动分段迁移&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0) ; letter-spacing: 2px ; text-align: justify&quot;&gt;的方式来大幅度提升多线程高并发执行CAS操作的性能！&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fontColor=#333333;fillColor=#f5f5f5;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="75" y="2530" width="940" height="30" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-64" value="&lt;pre style=&quot;color: rgb(169 , 183 , 198) ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 12pt&quot;&gt;&lt;br&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=19;align=left;strokeColor=none;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="594" y="2880" width="340" height="190" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-65" value="线程A" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;fontSize=18;align=center;strokeColor=#6c8ebf;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="414" y="2600" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-66" value="线程B" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;fontSize=18;align=center;strokeColor=#d6b656;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="701.5" y="2600" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-67" value="线程C" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;fontSize=18;align=center;strokeColor=#b85450;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="984" y="2600" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-68" value="" style="endArrow=none;html=1;strokeWidth=2;fontSize=22;fontColor=#FF0000;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=0.011;exitY=0.48;exitDx=0;exitDy=0;exitPerimeter=0;startArrow=classic;startFill=1;endFill=0;strokeColor=#4D9900;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-89" target="01sIQlWdCzxstv_JN03J-65" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="587" y="3000" as="sourcePoint" />
            <mxPoint x="454" y="2690" as="targetPoint" />
            <Array as="points">
              <mxPoint x="474" y="3024" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-70" value="" style="endArrow=classic;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-65" target="01sIQlWdCzxstv_JN03J-87" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="614" y="2750" as="sourcePoint" />
            <mxPoint x="594" y="2920" as="targetPoint" />
            <Array as="points">
              <mxPoint x="504" y="2930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-72" value="" style="endArrow=none;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.383;exitY=-0.017;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=classic;startFill=1;endFill=0;exitPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-87" target="01sIQlWdCzxstv_JN03J-66" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="784" y="2780" as="sourcePoint" />
            <mxPoint x="774" y="2730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-76" value="" style="endArrow=none;html=1;strokeColor=#FF0080;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.4;entryY=0.983;entryDx=0;entryDy=0;startArrow=classic;startFill=1;endFill=0;entryPerimeter=0;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-87" target="01sIQlWdCzxstv_JN03J-67" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1044" y="2840" as="sourcePoint" />
            <mxPoint x="1094" y="2790" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1032" y="2930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-78" value="" style="endArrow=classic;html=1;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.692;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1.022;entryY=0.58;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#4D9900;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-67" target="01sIQlWdCzxstv_JN03J-91" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1084" y="2820" as="sourcePoint" />
            <mxPoint x="964" y="3070" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1067" y="3029" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-87" value="base = 5" style="whiteSpace=wrap;html=1;fillColor=#e51400;fontSize=18;align=center;strokeColor=#B20000;fontColor=#ffffff;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="714" y="2900" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-89" value="cell&lt;br&gt;value = 2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="604" y="3000" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-90" value="cell&lt;br&gt;value = 3" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="721.5" y="3000" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-91" value="cell&lt;br&gt;value = 6" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="834" y="3000" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-74" value="" style="endArrow=classic;html=1;strokeWidth=2;fontSize=22;fontColor=#FF0000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;strokeColor=#4D9900;" parent="OxfkeTKddjhHw0AheIVP-1" source="01sIQlWdCzxstv_JN03J-66" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="804" y="2770" as="sourcePoint" />
            <mxPoint x="790" y="2996" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="01sIQlWdCzxstv_JN03J-92" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;在LongAdder的底层实现中，首先有一个base值，刚开始多线程来不停的累加数值，都是对base进行累加的，比如刚开始累加成了base = 5。&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;接着如果发现并发更新的线程数量过多，就会开始施行&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;分段CAS的机制&lt;/strong&gt;，也就是&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(201, 56, 28); box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;内部会搞一个Cell数组，每个数组是一个数值分段&lt;/span&gt;。&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;这时，让大量的线程分别去对不同Cell内部的value值进行CAS累加操作，这样就把CAS计算压力分散到了不同的Cell分段数值中了！&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;这样就可以大幅度的降低多线程并发更新同一个数值时出现的无限循环的问题，大幅度提升了多线程并发更新数值的性能和效率！&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;而且他内部实现了&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;自动分段迁移的机制&lt;/strong&gt;，也就是如果某个Cell的value执行CAS失败了，那么就会自动去找另外一个Cell分段内的value值进行CAS操作。&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;这样也&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(201, 56, 28); box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;解决了线程空旋转、自旋不停等待执行CAS操作的问题&lt;/span&gt;，让一个线程过来执行CAS时可以尽快的完成这个操作。&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); letter-spacing: 0.621714px; text-align: justify; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word; font-size: 16px;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; letter-spacing: 2px; font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;最后，如果你要从LongAdder中获取当前累加的总值，就会把base值和所有Cell分段数值加起来返回给你。&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#dae8fc;" parent="OxfkeTKddjhHw0AheIVP-1" vertex="1">
          <mxGeometry x="160" y="3150" width="1250" height="420" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="lPSfdG7mSfKspan5xp3j" name="AQS">
    <mxGraphModel dx="1899" dy="1043" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="tKw40Ly27kMV1H0R8ahZ-0" />
        <mxCell id="tKw40Ly27kMV1H0R8ahZ-1" parent="tKw40Ly27kMV1H0R8ahZ-0" />
        <mxCell id="2yfIsKCGeYPUNgimlRBR-87" value="" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#eeeeee;fontSize=16;align=left;strokeColor=none;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="2110" width="1350" height="620" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-0" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 22px&quot;&gt;AQS&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fontColor=#FF0000;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="680" y="10" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-1" value="&lt;pre style=&quot;background-color: #2b2b2b ; color: #a9b7c6 ; font-family: &amp;#34;meslo lg m dz for powerline&amp;#34; , monospace ; font-size: 12.0pt&quot;&gt;ReentrantLock lock = &lt;span style=&quot;color: #cc7832&quot;&gt;new &lt;/span&gt;ReentrantLock&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;&lt;br&gt;&lt;/span&gt;lock.lock&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;try &lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #808080&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-family: &amp;#34;menlo-regular&amp;#34; , monospace&quot;&gt;一堆业务逻辑&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;catch &lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;(&lt;/span&gt;Exception e&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;e.printStackTrace&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;finally &lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;    &lt;/span&gt;lock.unlock&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #cc7832&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9876aa ; font-style: italic&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;fillColor=none;fontSize=16;fontColor=#FF0000;align=left;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="200" width="400" height="200" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-3" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(201 , 56 , 28) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 15px ; letter-spacing: 2px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;AbstractQueuedSynchronizer，抽象队列同步器&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fontColor=#FF0000;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="520" y="90" width="420" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-10" value="" style="group" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1" connectable="0">
          <mxGeometry x="690" y="200" width="340" height="200" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-4" value="" style="whiteSpace=wrap;html=1;fillColor=#ffcc99;fontSize=16;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-10" vertex="1">
          <mxGeometry width="340" height="200" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-7" value="&lt;font style=&quot;font-size: 18px&quot;&gt;AbstractQueueSynchronizer&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#cdeb8b;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-10" vertex="1">
          <mxGeometry x="43.87096774193548" y="137.5" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-8" value="ReentrantLock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#ffcc99;" parent="2yfIsKCGeYPUNgimlRBR-10" vertex="1">
          <mxGeometry x="76.77419354838709" y="43.75" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-11" value="&lt;span style=&quot;background-color: rgb(230 , 230 , 230)&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 0.5px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;ReentrantLock&lt;/span&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px&quot;&gt;内部包含了一个AQS对象，也就是&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 0.5px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;AbstractQueuedSynchronizer&lt;/span&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px&quot;&gt;类型的对象。&lt;br&gt;这个AQS对象就是&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 0.5px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;ReentrantLock&lt;/span&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px&quot;&gt;可以实现加锁和释放锁的关键性的核心组件。&lt;/span&gt;&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="690" y="410" width="690" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-12" value="&lt;b&gt;ReentrantLock加锁和释放锁的底层原理&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="155" y="535" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-17" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;用ReentrantLock的lock()方法进行加锁，会发生什么事情呢？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;很简单，这个AQS对象内部有一个核心的变量叫做&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;state&lt;/strong&gt;，是int类型的，代表了&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;加锁的状态&lt;/strong&gt;。初始状态下，这个state的值是0。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;另外，这个AQS内部还有一个&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;关键变量&lt;/strong&gt;，用来记录&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;当前加锁的是哪个线程&lt;/strong&gt;，初始化状态下，这个变量是null。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="585" width="990" height="110" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-26" value="&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px ; background-color: rgb(230 , 230 , 230)&quot;&gt;线程1跑过来调用ReentrantLock的lock()方法尝试进行加锁，这个加锁的过程，直接就是用CAS操作将state值从0变为1。&lt;br&gt;&lt;div&gt;如果之前没人加过锁，那么state的值肯定是0，此时线程1就可以加锁成功。一旦线程1加锁成功，就可以设置当前加锁线程是自己&lt;/div&gt;&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1040" width="990" height="50" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-27" value="" style="group" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1" connectable="0">
          <mxGeometry x="210" y="770" width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-18" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-27" vertex="1" connectable="0">
          <mxGeometry width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-19" value="" style="whiteSpace=wrap;html=1;fillColor=#ffcc99;fontSize=16;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-21" value="ReentrantLock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#ffcc99;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry x="160.00483870967741" y="10" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-22" value="" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;fontSize=20;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry x="60" y="70" width="340" height="140" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-25" value="&lt;span&gt;&lt;font color=&quot;#000000&quot;&gt;AbstractQueueSynchronizer&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry x="85" y="70" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-23" value="&lt;font color=&quot;#000000&quot;&gt;state = 0&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=none;fontSize=20;fontColor=#FF0000;align=center;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry x="90" y="150" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-24" value="&lt;font color=&quot;#000000&quot;&gt;加锁线程 = null&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=none;fontSize=20;fontColor=#FF0000;align=center;" parent="2yfIsKCGeYPUNgimlRBR-18" vertex="1">
          <mxGeometry x="240" y="150" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-45" value="&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; letter-spacing: 2px; font-size: 15px; color: rgb(64, 179, 230); box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;可重入锁的意思&lt;/span&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); letter-spacing: 2px; font-size: 15px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;，就是你可以对一个ReentrantLock对象多次执行lock()加锁和unlock()释放锁，也就是可以对一个锁加多次，叫做可重入加锁。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1470" width="1110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-46" value="&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 2px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; font-size: 15px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;锁的互斥是如何实现的？&lt;/span&gt;&lt;/strong&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); letter-spacing: 2px; font-size: 15px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;线程2跑过来一下看到，哎呀！state的值不是0啊？所以CAS操作将state从0变为1的过程会失败，因为state的值当前为1，说明已经有人加锁了！&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1540" width="1300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-47" value="&lt;span style=&quot;background-color: rgb(230 , 230 , 230)&quot;&gt;&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px;&quot;&gt;接着线程2会看一下，&lt;/span&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; font-size: 15px; letter-spacing: 2px; color: rgb(64, 179, 230); box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;是不是自己之前加的锁啊&lt;/span&gt;&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px;&quot;&gt;？当然不是了，&lt;/span&gt;&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;“加锁线程”&lt;/strong&gt;&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px;&quot;&gt;这个变量明确记录了是线程1占用了这个锁，所以线程2此时就是加锁失败。&lt;/span&gt;&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1610" width="1140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-48" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;接着，线程2会将自己放入AQS中的一个等待队列，因为自己尝试加锁失败了，此时就要将自己放入队列中来等待，等待线程1释放锁之后，自己就可以重新尝试加锁了&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以大家可以看到，AQS是如此的核心！AQS内部还有一个等待队列，专门放那些加锁失败的线程！&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1685" width="1280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-49" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 14px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;接着，线程1在执行完自己的业务逻辑代码之后，就会释放锁！&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;他释放锁的过程非常的简单&lt;/strong&gt;，就是将AQS内的state变量的值递减1，如果state值为0，则彻底释放锁，会将“加锁线程”变量也设置为null！&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="155" y="1825" width="1450" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-50" value="&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); letter-spacing: 2px; font-size: 15px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;接下来，会从&lt;/span&gt;&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; color: rgb(51, 51, 51); letter-spacing: 2px; font-size: 15px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;等待队列的队头唤醒线程2重新尝试加锁。&lt;/strong&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="1920" width="430" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-51" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;线程2现在就重新尝试加锁，这时还是用CAS操作将state从0变为1，此时就会成功，成功之后代表加锁成功，就会将state设置为1。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此外，还要把&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;“加锁线程”&lt;/strong&gt;设置为线程2自己，同时线程2自己就从等待队列中出队了。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#eeeeee;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="160" y="2000" width="1030" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-86" value="" style="group" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1" connectable="0">
          <mxGeometry x="290" y="2170" width="1108.333333333333" height="510" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-52" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1" connectable="0">
          <mxGeometry width="1108.333333333333" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-44" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-52" vertex="1" connectable="0">
          <mxGeometry width="1108.333333333333" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-28" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-44" vertex="1" connectable="0">
          <mxGeometry x="408.33" y="-30" width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-29" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-28" vertex="1" connectable="0">
          <mxGeometry width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-30" value="" style="whiteSpace=wrap;html=1;fillColor=#ffcc99;fontSize=16;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-31" value="ReentrantLock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#ffcc99;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="550.0003897849463" y="-0.0033333333333338544" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-32" value="" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;fontSize=20;align=center;strokeColor=none;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="87.5" y="100" width="592.5" height="145" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-33" value="&lt;span&gt;&lt;font color=&quot;#000000&quot;&gt;AbstractQueueSynchronizer&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="191.6683333333333" y="99.99666666666666" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-34" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 16px&quot;&gt;state = 1&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#ffff88;fontSize=20;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="128.67" y="180.83333333333331" width="131.25" height="35" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-35" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 16px&quot;&gt;加锁线程 = 线程2&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#ffcccc;fontSize=20;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="291.67" y="180.83333333333331" width="142.27" height="35" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-60" value="" style="group" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1" connectable="0">
          <mxGeometry x="461.66666666666686" y="180.83333333333331" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-57" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程2&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-60" vertex="1">
          <mxGeometry width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-58" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程xx&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-60" vertex="1">
          <mxGeometry x="60" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-59" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程3&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-60" vertex="1">
          <mxGeometry x="120" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-75" value="" style="endArrow=classic;html=1;strokeColor=#FF00FF;strokeWidth=2;fontSize=20;fontColor=#FF0000;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="2yfIsKCGeYPUNgimlRBR-29" target="2yfIsKCGeYPUNgimlRBR-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="471.6700000000001" y="181" as="sourcePoint" />
            <mxPoint x="811.6700000000001" y="350" as="targetPoint" />
            <Array as="points">
              <mxPoint x="471.6700000000001" y="140" />
              <mxPoint x="226.67000000000007" y="140" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-79" value="再次尝试CAS,将state从0变成1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fontColor=#FF00FF;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="235" y="140" width="230" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-80" value="" style="endArrow=classic;html=1;strokeColor=#FF00FF;strokeWidth=2;fontSize=16;fontColor=#FF00FF;entryX=0.696;entryY=0.976;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.267;exitY=1.072;exitDx=0;exitDy=0;exitPerimeter=0;" parent="2yfIsKCGeYPUNgimlRBR-29" source="2yfIsKCGeYPUNgimlRBR-57" target="2yfIsKCGeYPUNgimlRBR-35" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="671.6700000000001" y="410" as="sourcePoint" />
            <mxPoint x="721.6700000000001" y="360" as="targetPoint" />
            <Array as="points">
              <mxPoint x="477.6700000000001" y="310" />
              <mxPoint x="390.6700000000001" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tTTHRX27jEOATHOqyqnr-2" value="&lt;font style=&quot;font-size: 14px&quot;&gt;等待队列&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="2yfIsKCGeYPUNgimlRBR-29" vertex="1">
          <mxGeometry x="516.6700000000001" y="160" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="2yfIsKCGeYPUNgimlRBR-44" source="2yfIsKCGeYPUNgimlRBR-38" target="2yfIsKCGeYPUNgimlRBR-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="291.66666666666663" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-38" value="&lt;font style=&quot;font-size: 16px&quot;&gt;线程1&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#cce5ff;fontSize=20;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-44" vertex="1">
          <mxGeometry y="90.00000000000001" width="174.99999999999997" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-41" value="&lt;font style=&quot;font-size: 16px&quot;&gt;CAS&amp;nbsp;&lt;br&gt;设置state=1&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-44" vertex="1">
          <mxGeometry x="189.58333333333331" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-42" value="" style="endArrow=classic;html=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="2yfIsKCGeYPUNgimlRBR-44" source="2yfIsKCGeYPUNgimlRBR-38" target="2yfIsKCGeYPUNgimlRBR-35" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160.41666666666663" y="220" as="sourcePoint" />
            <mxPoint x="233.33333333333326" y="170" as="targetPoint" />
            <Array as="points">
              <mxPoint x="87.49999999999999" y="270" />
              <mxPoint x="736" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-43" value="&lt;font style=&quot;font-size: 16px&quot;&gt;如果CAS成功 设置 加锁线程=线程1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-44" vertex="1">
          <mxGeometry x="102.08333333333329" y="240" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-63" value="" style="endArrow=classic;html=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="2yfIsKCGeYPUNgimlRBR-44" source="2yfIsKCGeYPUNgimlRBR-38" target="2yfIsKCGeYPUNgimlRBR-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="-10" as="sourcePoint" />
            <mxPoint x="220" y="-60" as="targetPoint" />
            <Array as="points">
              <mxPoint x="88" y="50" />
              <mxPoint x="603" y="50" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-73" value="" style="endArrow=classic;html=1;strokeWidth=2;fontSize=20;fontColor=#FF0000;entryX=0.45;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#FF00FF;" parent="2yfIsKCGeYPUNgimlRBR-44" target="2yfIsKCGeYPUNgimlRBR-57" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="50" y="90" as="sourcePoint" />
            <mxPoint x="50" as="targetPoint" />
            <Array as="points">
              <mxPoint x="50" y="20" />
              <mxPoint x="897" y="20" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-74" value="&lt;font style=&quot;font-size: 16px&quot; color=&quot;#ff00ff&quot;&gt;线程1释放锁成功后，唤醒等待队列中的线程2&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=20;fontColor=#FF0000;labelBackgroundColor=none;" parent="2yfIsKCGeYPUNgimlRBR-73" vertex="1" connectable="0">
          <mxGeometry x="-0.0056" y="3" relative="1" as="geometry">
            <mxPoint x="101.63" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-62" value="&lt;font style=&quot;font-size: 16px&quot;&gt;线程2&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#cce5ff;fontSize=20;align=center;strokeColor=#36393d;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry y="390" width="174.99999999999997" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-64" value="&lt;span style=&quot;font-size: 16px&quot;&gt;释放锁 state -1 = 0&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry x="135" y="15" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-65" value="" style="endArrow=classic;html=1;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=#FF3333;" parent="2yfIsKCGeYPUNgimlRBR-86" source="2yfIsKCGeYPUNgimlRBR-62" target="2yfIsKCGeYPUNgimlRBR-34" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="570" y="440" as="sourcePoint" />
            <mxPoint x="620" y="390" as="targetPoint" />
            <Array as="points">
              <mxPoint x="603" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-66" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 16px&quot;&gt;CAS&lt;br&gt;尝试state从0变成1 失败！&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry x="180" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-67" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;strokeWidth=2;fontSize=20;fontColor=#FF0000;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="2yfIsKCGeYPUNgimlRBR-86" target="2yfIsKCGeYPUNgimlRBR-35" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="130" y="450" as="sourcePoint" />
            <mxPoint x="590" y="210" as="targetPoint" />
            <Array as="points">
              <mxPoint x="130" y="470" />
              <mxPoint x="771" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-70" value="&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;CAS失败后，看看是不是自己之前加过锁？不是！&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry x="175" y="440" width="370" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-71" value="" style="endArrow=classic;html=1;strokeColor=#FF3333;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=0.469;exitY=1.017;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1.167;entryDx=0;entryDy=0;entryPerimeter=0;" parent="2yfIsKCGeYPUNgimlRBR-86" source="2yfIsKCGeYPUNgimlRBR-62" target="2yfIsKCGeYPUNgimlRBR-57" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="630" as="sourcePoint" />
            <mxPoint x="330" y="580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="82" y="510" />
              <mxPoint x="900" y="510" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-72" value="&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;加锁失败，将自己放入等待队列中&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry x="260" y="480" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yfIsKCGeYPUNgimlRBR-82" value="加锁成功&lt;br&gt;设置&lt;br&gt;加锁线程=线程2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fontColor=#FF00FF;" parent="2yfIsKCGeYPUNgimlRBR-86" vertex="1">
          <mxGeometry x="770" y="260" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-0" value="" style="group" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1" connectable="0">
          <mxGeometry x="170" y="1150" width="1108.333333333333" height="280" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-1" value="" style="group" parent="EU60Jf_YvhfZJlRJeAG6-0" vertex="1" connectable="0">
          <mxGeometry x="408.33" y="-30" width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-2" value="" style="group" parent="EU60Jf_YvhfZJlRJeAG6-1" vertex="1" connectable="0">
          <mxGeometry width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-3" value="" style="whiteSpace=wrap;html=1;fillColor=#ffcc99;fontSize=16;align=center;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry width="700" height="280" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-4" value="ReentrantLock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#ffcc99;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry x="550.0003897849463" y="-0.0033333333333338544" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-5" value="" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;fontSize=20;align=center;strokeColor=none;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry x="87.5" y="100" width="592.5" height="145" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-6" value="&lt;span&gt;&lt;font color=&quot;#000000&quot;&gt;AbstractQueueSynchronizer&lt;/font&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry x="191.6683333333333" y="99.99666666666666" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-7" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 16px&quot;&gt;state = 1&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#ffff88;fontSize=20;align=center;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry x="128.67" y="180.83333333333331" width="131.25" height="35" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-8" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 16px&quot;&gt;加锁线程 = 线程1&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#ffcccc;fontSize=20;align=center;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1">
          <mxGeometry x="291.67" y="180.83333333333331" width="142.27" height="35" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-9" value="" style="group" parent="EU60Jf_YvhfZJlRJeAG6-2" vertex="1" connectable="0">
          <mxGeometry x="461.66666666666686" y="180.83333333333331" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-10" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程2&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-9" vertex="1">
          <mxGeometry width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-11" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程xx&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-9" vertex="1">
          <mxGeometry x="60" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-12" value="&lt;span style=&quot;font-size: 16px&quot;&gt;线程yy&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fillColor=#cce5ff;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-9" vertex="1">
          <mxGeometry x="120" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;endArrow=classic;endFill=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="EU60Jf_YvhfZJlRJeAG6-0" source="EU60Jf_YvhfZJlRJeAG6-17" target="EU60Jf_YvhfZJlRJeAG6-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="291.66666666666663" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-17" value="&lt;font style=&quot;font-size: 16px&quot;&gt;线程1&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#cce5ff;fontSize=20;align=center;strokeColor=#36393d;" parent="EU60Jf_YvhfZJlRJeAG6-0" vertex="1">
          <mxGeometry y="90.00000000000001" width="174.99999999999997" height="60" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-18" value="&lt;font style=&quot;font-size: 16px&quot;&gt;CAS&amp;nbsp;&lt;br&gt;设置state=1&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="EU60Jf_YvhfZJlRJeAG6-0" vertex="1">
          <mxGeometry x="189.58333333333331" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-19" value="" style="endArrow=classic;html=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="EU60Jf_YvhfZJlRJeAG6-0" source="EU60Jf_YvhfZJlRJeAG6-17" target="EU60Jf_YvhfZJlRJeAG6-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160.41666666666663" y="220" as="sourcePoint" />
            <mxPoint x="233.33333333333326" y="170" as="targetPoint" />
            <Array as="points">
              <mxPoint x="87.49999999999999" y="270" />
              <mxPoint x="736" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-20" value="&lt;font style=&quot;font-size: 16px&quot;&gt;如果CAS成功 设置 加锁线程=线程1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF0000;" parent="EU60Jf_YvhfZJlRJeAG6-0" vertex="1">
          <mxGeometry x="102.08333333333329" y="240" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="EU60Jf_YvhfZJlRJeAG6-21" value="" style="endArrow=classic;html=1;strokeColor=#4D9900;strokeWidth=2;fontSize=20;fontColor=#FF0000;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="EU60Jf_YvhfZJlRJeAG6-0" source="EU60Jf_YvhfZJlRJeAG6-17" target="EU60Jf_YvhfZJlRJeAG6-7" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="-10" as="sourcePoint" />
            <mxPoint x="220" y="-60" as="targetPoint" />
            <Array as="points">
              <mxPoint x="88" y="50" />
              <mxPoint x="603" y="50" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tTTHRX27jEOATHOqyqnr-0" value="&lt;font style=&quot;font-size: 16px&quot;&gt;线程3&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#cce5ff;fontSize=20;align=center;strokeColor=#36393d;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="1300" y="2570" width="174.99999999999997" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tTTHRX27jEOATHOqyqnr-1" value="" style="endArrow=classic;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.983;entryY=0.439;entryDx=0;entryDy=0;entryPerimeter=0;" parent="tKw40Ly27kMV1H0R8ahZ-1" source="tTTHRX27jEOATHOqyqnr-0" target="2yfIsKCGeYPUNgimlRBR-59" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1370" y="2570" as="sourcePoint" />
            <mxPoint x="1420" y="2520" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1431" y="2334" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tTTHRX27jEOATHOqyqnr-3" value="&lt;font style=&quot;font-size: 14px&quot;&gt;线程3&lt;br&gt;先判断等待队列中是否存在等待的队列，&lt;br&gt;如果有，就加入队列&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="tKw40Ly27kMV1H0R8ahZ-1" vertex="1">
          <mxGeometry x="1252.5" y="2430" width="270" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
