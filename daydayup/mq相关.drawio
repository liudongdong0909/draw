<mxfile host="app.diagrams.net" modified="2020-10-09T08:05:55.615Z" agent="5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36" etag="vp1lPT9xu567HGouQGSK" version="13.7.6" type="github" pages="3">
  <diagram id="JzXBgew2gPKfXDzcpc2j" name="消息中间件全链路数据100%不丢失">
    <mxGraphModel dx="1852" dy="1034" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-1" value="&lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot; style=&quot;margin: 0px 0px 14px ; padding: 0px ; font-size: 22px ; line-height: 1.4 ; letter-spacing: 0.621714px&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;线上服务宕机时，如何保证数据100%不丢失？&lt;/font&gt;&lt;/h2&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="30" width="480" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="430" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="310" />
              <mxPoint x="440" y="430" />
              <mxPoint x="516" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-3" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-5" target="Lkm7xPwdyCk8JkXtMmqo-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="430" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-5" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-7" target="Lkm7xPwdyCk8JkXtMmqo-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="480" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="590" />
              <mxPoint x="440" y="470" />
              <mxPoint x="510" y="470" />
              <mxPoint x="510" y="471" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-7" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-8" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="385" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-10" target="Lkm7xPwdyCk8JkXtMmqo-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-10" value="&lt;b style=&quot;font-size: 14px&quot;&gt;仓储服务&lt;br&gt;(突然宕机)&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1040" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-12" target="Lkm7xPwdyCk8JkXtMmqo-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-12" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1040" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-14" target="Lkm7xPwdyCk8JkXtMmqo-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-14" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1040" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-15" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" target="Lkm7xPwdyCk8JkXtMmqo-10" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="851" y="430" as="sourcePoint" />
            <mxPoint x="980" y="440" as="targetPoint" />
            <Array as="points">
              <mxPoint x="940" y="430" />
              <mxPoint x="940" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-16" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-8" target="Lkm7xPwdyCk8JkXtMmqo-12" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="490" as="sourcePoint" />
            <mxPoint x="950" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-17" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-8" target="Lkm7xPwdyCk8JkXtMmqo-14" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="850" y="450" as="sourcePoint" />
            <mxPoint x="950" y="550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="940" y="470" />
              <mxPoint x="940" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-18" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-19" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="280" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-20" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-21" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="290" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-22" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="430" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-23" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="570" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-24" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="650" y="385" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-25" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="440" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-26" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="660" y="440" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-28" target="Lkm7xPwdyCk8JkXtMmqo-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-28" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="480" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-30" target="Lkm7xPwdyCk8JkXtMmqo-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-30" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="645" y="480" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-31" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="750" y="480" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-32" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="290" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-33" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="430" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-34" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="570" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-35" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="555" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-36" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="420" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-37" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="280" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-38" value="&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 16px; letter-spacing: 2px; background-color: rgb(255, 255, 255);&quot;&gt;如果仓储服务作为消费者服务，刚收到了一个订单消息，但是在完成消息的处理之前，也就是还没对订单完成仓储调度发货，结果这个仓储服务突然就宕机了，这个时候会发生什么事情？&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="160" y="170" width="1490" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-39" value="&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px ; background-color: rgb(255 , 255 , 255)&quot;&gt;RabbitMQ这个中间件默认的一个行为，就是只要仓储服务收到一个订单消息，RabbitMQ就会立马把这条订单消息给标记为删除，&lt;/span&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;这个行为叫做自动ack，&lt;br&gt;&lt;br&gt;&lt;/strong&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px ; letter-spacing: 2px ; background-color: rgb(255 , 255 , 255)&quot;&gt;也就是投递完成一条消息就自动确认这个消息处理完毕了。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;fontSize=16;horizontal=1;" parent="1" vertex="1">
          <mxGeometry x="165" y="660" width="1180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-40" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;但是接着如果此时仓储服务收到了一个订单消息，但是还没来得及对仓库系统完成商品的调度发货，结果直接就宕机了。&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时，明显这个订单消息就丢失了啊，因为RabbitMQ那里已经没有了。。。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="155" y="750" width="930" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-41" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; font-size: 15px ; color: rgb(110 , 191 , 248) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;这会导致什么样的尴尬体验呢？&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; font-size: 15px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;就是一个用户支付了8999元，对一个iphone8下了订单，结果呢，死等活等了好几天，就是不见网站上显示他的iphone8在发货。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;font-size: 15px ; letter-spacing: 2px&quot;&gt;搞了半天，原因就是他的那个iphone8的订单在仓储服务那里，还没来得及调度发货直接就宕机了，导致这个订单消息就一直丢失了，始终没有给这个用户通知仓库系统进行发货。&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;font-size: 15px ; letter-spacing: 2px&quot;&gt;这个问题，是不是很尴尬？所以说，技术问题是会严重影响企业的核心业务流程的！&lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="160" y="870" width="1370" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-42" value="channle.basicConsume(QUEUE_NAME, true, diliverCallback, consumerTag -&amp;gt; {});&lt;br&gt;&lt;span style=&quot;text-align: center&quot;&gt;这行代码的第二个参数 true, 代表了一个核心含义： RabbitMQ只要把一个消息投递到消费者手上，立马就标记这个消息删除了。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fillColor=#cdeb8b;" parent="1" vertex="1">
          <mxGeometry x="165" y="1000" width="920" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-43" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;但是在这个默认的配置之下，要是仓储服务收到一个订单消息，结果还没来得及完成耗时几十秒的仓储调度发货的业务逻辑，结果突然宕机了，那么这个订单消息就永久性丢失了！&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="160" y="1060" width="1370" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-44" value="&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px; background-color: rgb(255, 255, 255);&quot;&gt;只要修改为false之后，RabbitMQ就不会盲目的投递消息到仓储服务，立马就删除消息了，说白了就是关闭autoAck的行为，不要自作主张的认为消息处理成功了。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="160" y="1120" width="1250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-45" value="&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 18px ; letter-spacing: 2px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;这段代码，说白了，就是在对订单完成了调度发货之后，&lt;br&gt;&lt;/span&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 18px ; letter-spacing: 2px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;在finally代码块中手动执行了ack操作&lt;/strong&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-size: 18px ; letter-spacing: 2px ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;，&lt;br&gt;&lt;br style=&quot;font-size: 18px&quot;&gt;说我自己已经完成了耗时几十秒的业务逻辑的处理，&lt;br&gt;现在可以手动ack通知RabbitMQ，这个消息处理完毕了。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fillColor=#f5f5f5;fontColor=#333333;" parent="1" vertex="1">
          <mxGeometry x="1025" y="1255" width="530" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-46" value="DeliverCallback deliverCallback = (consumerTag, delivery) -&amp;gt; {&lt;br style=&quot;font-size: 18px;&quot;&gt;&lt;br style=&quot;font-size: 18px;&quot;&gt;try{&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; String message = new String(delivery.getBody(), &quot;UTF-8&quot;);&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; System.olut.println(&quot;[x] 仓储服务接收到消息，准备执行调度发货的流程 &quot; + message);&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp;}finaly{&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;System.out.printly(&quot;[x] 订单完成调度发货&quot;);&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// 这就是核心代码，手动在代码里对RabbitMQ进行ack&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;channel.basicAck(delivery.getEnvenlope().getDeliveryTag(), false);&lt;br style=&quot;font-size: 18px;&quot;&gt;&amp;nbsp; &amp;nbsp;}&lt;br style=&quot;font-size: 18px;&quot;&gt;};" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=18;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="160" y="1210" width="720" height="250" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-47" value="" style="endArrow=classic;html=1;fontSize=18;entryX=1.001;entryY=0.44;entryDx=0;entryDy=0;entryPerimeter=0;exitX=-0.004;exitY=0.544;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-45" target="Lkm7xPwdyCk8JkXtMmqo-46" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1070" y="1420" as="sourcePoint" />
            <mxPoint x="1120" y="1280" as="targetPoint" />
            <Array as="points">
              <mxPoint x="960" y="1320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-49" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="1800" as="targetPoint" />
            <Array as="points">
              <mxPoint x="395" y="1680" />
              <mxPoint x="395" y="1800" />
              <mxPoint x="471" y="1800" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-49" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="185" y="1650" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-51" target="Lkm7xPwdyCk8JkXtMmqo-54" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="385" y="1820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-51" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="185" y="1790" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-53" target="Lkm7xPwdyCk8JkXtMmqo-54" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="465" y="1850" as="targetPoint" />
            <Array as="points">
              <mxPoint x="395" y="1960" />
              <mxPoint x="395" y="1840" />
              <mxPoint x="465" y="1840" />
              <mxPoint x="465" y="1841" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-53" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="185" y="1930" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-54" value="" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="475" y="1755" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-55" value="&lt;b style=&quot;font-size: 14px&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="995" y="1580" width="155" height="170" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-57" target="Lkm7xPwdyCk8JkXtMmqo-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-57" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1030" y="1790" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-59" target="Lkm7xPwdyCk8JkXtMmqo-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-59" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1030" y="1930" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-60" value="" style="endArrow=classic;html=1;entryX=-0.017;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" target="Lkm7xPwdyCk8JkXtMmqo-83" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="806" y="1800" as="sourcePoint" />
            <mxPoint x="935" y="1810" as="targetPoint" />
            <Array as="points">
              <mxPoint x="895" y="1800" />
              <mxPoint x="895" y="1608" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-61" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-54" target="Lkm7xPwdyCk8JkXtMmqo-57" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="855" y="1860" as="sourcePoint" />
            <mxPoint x="905" y="1810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-62" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-54" target="Lkm7xPwdyCk8JkXtMmqo-59" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="805" y="1820" as="sourcePoint" />
            <mxPoint x="905" y="1920" as="targetPoint" />
            <Array as="points">
              <mxPoint x="895" y="1840" />
              <mxPoint x="895" y="1960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-63" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1930" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-64" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1230" y="1615" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-65" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1790" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-66" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="315" y="1660" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-67" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="315" y="1800" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-68" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="315" y="1940" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-69" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="605" y="1755" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-70" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="495" y="1810" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-71" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="615" y="1810" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-73" target="Lkm7xPwdyCk8JkXtMmqo-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-73" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="495" y="1850" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-75" target="Lkm7xPwdyCk8JkXtMmqo-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-75" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="600" y="1850" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-76" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="705" y="1850" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-77" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="905" y="1610" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-78" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="905" y="1800" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-79" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="905" y="1940" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-80" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1160" y="1930" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-81" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1160" y="1790" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-82" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="1630" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-83" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1027.5" y="1600" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-84" value="仓库服务&lt;br&gt;是否成功&lt;br&gt;调度" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=14;align=center;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1035" y="1660" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-85" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;shadow=1;" parent="1" target="Lkm7xPwdyCk8JkXtMmqo-84" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1075" y="1620" as="sourcePoint" />
            <mxPoint x="1250" y="1710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-83" target="Lkm7xPwdyCk8JkXtMmqo-64" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1174" y="1610" />
              <mxPoint x="1174" y="1645" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-87" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.5;exitDx=0;exitDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-84" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="1710" as="sourcePoint" />
            <mxPoint x="540" y="1768" as="targetPoint" />
            <Array as="points">
              <mxPoint x="540" y="1700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-88" value="接收ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="495" y="1770" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-89" value="发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="1680" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-90" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.38;exitY=1.05;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-88" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="537" y="1789" as="sourcePoint" />
            <mxPoint x="532" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-91" value="标记删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="1820" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-92" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;架构流程改成上面那样后，就意味着只有完成了仓储调度发货的代码业务逻辑，确保仓库系统收到通知之后，仓储服务才会在代码中手动发送ack消息给RabbitMQ。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时，RabbitMQ收到了这个ack消息，才会标记对应的订单消息被删除了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果说在仓储服务收到了订单消息，但是还没来得及完成仓储调度发货的业务逻辑，那也就绝对不会执行这条订单消息的ack操作，然后RabbitMQ也就不会收到这条订单消息的ack通知。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;一旦RabbitMQ发现代表消费者的某个仓储服务实例突然宕机了，而这个仓储服务收到的一些订单消息还没来得及处理，没给自己发送那些消息的ack通知。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时，RabbitMQ会自动对这条订单消息重发推送给其他在运行中的仓储服务实例，让其他的仓储服务实例去处理这条订单消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样的话，就可以保证这条订单消息不会因为某个仓储服务实例的宕机而丢失，他会确保必须由某个仓储服务实例完成这条订单消息的调度发货处理，然后才会删除那条订单消息。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="185" y="2070" width="1430" height="390" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-93" value="" style="endArrow=classic;html=1;fontSize=14;exitX=-0.027;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-96" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="830" y="1810" as="sourcePoint" />
            <mxPoint x="720" y="1760" as="targetPoint" />
            <Array as="points">
              <mxPoint x="920" y="1740" />
              <mxPoint x="720" y="1740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-94" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1075" y="1735" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-95" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1005" y="1690" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-96" value="不发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="1730" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-97" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.991;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-84" target="Lkm7xPwdyCk8JkXtMmqo-96" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1075" y="1740" as="sourcePoint" />
            <mxPoint x="1031" y="1760" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-98" value="发现消费者宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="760" y="1720" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-99" value="" style="endArrow=classic;html=1;fontSize=14;entryX=-0.033;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-73" target="Lkm7xPwdyCk8JkXtMmqo-59" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="2010" as="sourcePoint" />
            <mxPoint x="1020" y="1980" as="targetPoint" />
            <Array as="points">
              <mxPoint x="535" y="1980" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-100" value="未收到ACK&lt;br&gt;订单消息03重新消费" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="605" y="1960" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-101" value="&lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot; style=&quot;margin: 0px 0px 14px ; padding: 0px ; font-size: 22px ; line-height: 1.4 ; letter-spacing: 0.621714px&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;消息中间件集群崩溃，如何保证百万生产数据不丢失？&lt;/font&gt;&lt;/h2&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="555" y="2580" width="560" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-102" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那如果此时出现一个问题，就是说订单服务投递了订单消息到RabbitMQ里去，RabbitMQ暂时放在了自己的内存中，还没来得及投递给下游的仓储服务呢，此时RabbitMQ突然宕机了，会怎么样？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;答案其实很简单，默认情况下，按照我们目前的代码和配置，这个数据就会丢失了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以在这里而言，就牵扯到了RabbitMQ的一个较为重要的概念：&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;消息的持久化&lt;/strong&gt;，用英文来说就是durable机制。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="130" y="2640" width="1510" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-103" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;然后这里又有一个引申的概念，如果按照我们之前的代码和配置，默认情况下，RabbitMQ一旦宕机就再次重启，就会丢失我们之前创建的queue。所以首先得先让queue是持久化的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;使用下面的代码，就可以把我们的“warehouse_schedule_delivery”这个queue，也就是仓储调度发货的queue，设置为持久化的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left ; margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样，即使RabbitMQ宕机后重启，也会恢复之前创建好的这个queue。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left ; margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 16px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;b&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;channel.queueDeclare(&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp;&quot;warehouse_schedule_delivery&quot;,&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;true,&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp; &amp;nbsp;false,&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp; &amp;nbsp;false,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp;null&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; color: rgb(110 , 191 , 248) ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;);&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;大家看到上面那行定义和创建queue的代码么？核心在于第二个参数，第二个参数是true。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;他的意思就是说，这&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;个创建的queue是durable的，也就是支持持久化的。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;RabbitMQ会把这queue的相关信息持久化的存储到磁盘上去，这样RabbitMQ重启后，就可以恢复持久化的queue。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="200" y="2860" width="1410" height="440" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-104" value="&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;OK，现在你的queue的信息可以持久化了，RabbitMQ宕机重启后会自动恢复queue。但是，你的queue里的message数据呢？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;queue里都是订单服务发送过去的订单消息数据，如果RabbitMQ还没来得及投递queue里的订单消息到仓储服务，结果RabbitMQ就宕机了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;那此时RabbitMQ重启之后，他可以恢复queue的信息，但是queue的message数据是没法恢复了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;所以此时还有一个重要的点，就是在你的订单服务发送消息到RabbitMQ的时候，需要定义这条消息也是durable，即持久化的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 16px ; letter-spacing: 2px ; text-align: left ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;b&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;channel.basicPublish(&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp;&quot;&quot;,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp;&quot;warehouse_schedule_delivery&quot;,&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; color: rgb(110 , 191 , 248)&quot;&gt;&amp;nbsp;MessageProperties.PERSISTENT_TEXT_PLAIN,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(110 , 191 , 248)&quot;&gt;message.getBytes());&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;通过上面的方式来发送消息，就可以让发送出去的消息是持久化的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;一旦标记了消息是持久化之后，就会让RabbitMQ把消息持久化写入到磁盘上去，此时如果RabbitMQ还没投递数据到仓储服务，结果就突然宕机了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 2px ; line-height: 2em ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;那么再次重启的时候，就会把磁盘上持久化的消息给加载出来。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="200" y="3330" width="1240" height="470" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-105" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-106" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="4070" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="3950" />
              <mxPoint x="440" y="4070" />
              <mxPoint x="516" y="4070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-106" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="3920" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-107" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-108" target="Lkm7xPwdyCk8JkXtMmqo-111" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="430" y="4090" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-108" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="4060" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-109" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-110" target="Lkm7xPwdyCk8JkXtMmqo-111" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="4120" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="4230" />
              <mxPoint x="440" y="4110" />
              <mxPoint x="510" y="4110" />
              <mxPoint x="510" y="4111" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-110" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="4200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-111" value="" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="4025" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-112" value="&lt;b style=&quot;font-size: 14px&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1040" y="3850" width="155" height="170" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-114" target="Lkm7xPwdyCk8JkXtMmqo-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-114" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1075" y="4060" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-115" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-116" target="Lkm7xPwdyCk8JkXtMmqo-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-116" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1075" y="4200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-117" value="" style="endArrow=classic;html=1;entryX=-0.017;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" target="Lkm7xPwdyCk8JkXtMmqo-140" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="851" y="4070" as="sourcePoint" />
            <mxPoint x="980" y="4080" as="targetPoint" />
            <Array as="points">
              <mxPoint x="940" y="4070" />
              <mxPoint x="940" y="3878" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-118" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-111" target="Lkm7xPwdyCk8JkXtMmqo-114" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="4130" as="sourcePoint" />
            <mxPoint x="950" y="4080" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-119" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-111" target="Lkm7xPwdyCk8JkXtMmqo-116" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="850" y="4090" as="sourcePoint" />
            <mxPoint x="950" y="4190" as="targetPoint" />
            <Array as="points">
              <mxPoint x="940" y="4110" />
              <mxPoint x="940" y="4230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-120" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1285" y="4200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-121" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1275" y="3885" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-122" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1285" y="4060" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-123" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="3930" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-124" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="4070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-125" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="360" y="4210" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-126" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="650" y="4025" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-127" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="4080" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-128" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="660" y="4080" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-129" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-130" target="Lkm7xPwdyCk8JkXtMmqo-132" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-130" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="4120" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-131" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-132" target="Lkm7xPwdyCk8JkXtMmqo-133" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-132" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="645" y="4120" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-133" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="750" y="4120" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-134" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="3880" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-135" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="4070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-136" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="4210" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-137" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1205" y="4200" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-138" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1205" y="4060" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-139" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1215" y="3900" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-140" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1072.5" y="3870" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-141" value="仓库服务&lt;br&gt;是否成功&lt;br&gt;调度" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=14;align=center;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3930" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-142" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;shadow=1;" parent="1" target="Lkm7xPwdyCk8JkXtMmqo-141" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="3890" as="sourcePoint" />
            <mxPoint x="1295" y="3980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-143" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-140" target="Lkm7xPwdyCk8JkXtMmqo-121" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1219" y="3880" />
              <mxPoint x="1219" y="3915" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-144" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.5;exitDx=0;exitDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-141" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="805" y="3980" as="sourcePoint" />
            <mxPoint x="585" y="4038" as="targetPoint" />
            <Array as="points">
              <mxPoint x="585" y="3970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-145" value="接收ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="4040" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-146" value="发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="725" y="3950" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-147" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.38;exitY=1.05;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-145" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="582" y="4059" as="sourcePoint" />
            <mxPoint x="577" y="4120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-148" value="标记删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="545" y="4090" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-149" value="" style="endArrow=classic;html=1;fontSize=14;exitX=-0.027;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-152" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875" y="4080" as="sourcePoint" />
            <mxPoint x="765" y="4030" as="targetPoint" />
            <Array as="points">
              <mxPoint x="965" y="4010" />
              <mxPoint x="765" y="4010" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-150" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1120" y="4005" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-151" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1050" y="3960" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-152" value="不发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="965" y="4000" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-153" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.991;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-141" target="Lkm7xPwdyCk8JkXtMmqo-152" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="4010" as="sourcePoint" />
            <mxPoint x="1076" y="4030" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-154" value="发现消费者宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="805" y="3990" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-155" value="" style="endArrow=classic;html=1;fontSize=14;entryX=-0.033;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-130" target="Lkm7xPwdyCk8JkXtMmqo-116" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="555" y="4280" as="sourcePoint" />
            <mxPoint x="1065" y="4250" as="targetPoint" />
            <Array as="points">
              <mxPoint x="580" y="4250" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-156" value="未收到ACK&lt;br&gt;订单消息03重新消费" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="650" y="4230" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-157" value="磁盘文件" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;fontSize=14;align=center;strokeColor=#9673a6;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="640" y="4391" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-158" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.055;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-127" target="Lkm7xPwdyCk8JkXtMmqo-157" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="4390" as="sourcePoint" />
            <mxPoint x="560" y="4340" as="targetPoint" />
            <Array as="points">
              <mxPoint x="556" y="4405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-159" value="持久化queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="560" y="4330" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-160" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-157" target="Lkm7xPwdyCk8JkXtMmqo-127" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="4510" as="sourcePoint" />
            <mxPoint x="460" y="4460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="540" y="4435" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-161" value="重启时加载&lt;br&gt;queue信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="550" y="4440" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-162" value="" style="endArrow=none;html=1;fontSize=14;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.931;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;endFill=0;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-157" target="Lkm7xPwdyCk8JkXtMmqo-127" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="4450" as="sourcePoint" />
            <mxPoint x="910" y="4400" as="targetPoint" />
            <Array as="points">
              <mxPoint x="810" y="4405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-163" value="" style="endArrow=none;html=1;fontSize=14;exitX=0.979;exitY=1.014;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;endFill=0;startArrow=classic;startFill=1;shadow=1;" parent="1" source="Lkm7xPwdyCk8JkXtMmqo-127" target="Lkm7xPwdyCk8JkXtMmqo-157" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="980" y="4460" as="sourcePoint" />
            <mxPoint x="1030" y="4410" as="targetPoint" />
            <Array as="points">
              <mxPoint x="824" y="4435" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-164" value="重启时加载&lt;br&gt;message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="760" y="4440" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-165" value="持久化message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="695" y="4330" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Lkm7xPwdyCk8JkXtMmqo-166" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; letter-spacing: 0.621714px ; text-align: justify ; font-size: 15px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;但是这里要注意一点，&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;RabbitMQ的消息持久化，是不承诺100%的消息不丢失的。&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; letter-spacing: 0.621714px ; text-align: justify ; font-size: 15px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; letter-spacing: 2px&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 16px&quot; color=&quot;#ff00ff&quot;&gt;因为有可能RabbitMQ接收到了消息，但是还没来得及持久化到磁盘，他自己就宕机了&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;color: rgb(51 , 51 , 51) ; font-size: 15px&quot;&gt;，这个时候消息还是会丢失的。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; letter-spacing: 0.621714px ; text-align: justify ; font-size: 15px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; letter-spacing: 0.621714px ; text-align: justify ; font-size: 15px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px&quot;&gt;如果要完全100%保证写入RabbitMQ的数据必须落地磁盘，不会丢失，需要依靠其他的机制。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="185" y="4520" width="960" height="150" as="geometry" />
        </mxCell>
        <mxCell id="nVV2XkVS_77D108Cf_11-1" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;实际上，作为生产者的订单服务把消息投递到MQ集群的过程是很容易丢数据的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如说网络出了点什么故障，数据压根儿没传输过去，或者就是上面说的消息刚刚被MQ接收但是还驻留在内存里，没落地到磁盘上，此时MQ集群宕机就会丢数据。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以首先，我们得考虑一下作为生产者的订单服务要如何利用RabbitMQ提供的相关功能来实现一个技术方案。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这个技术方案需要保证：&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;只要订单服务发送出去的消息确认成功了，此时MQ集群就一定已经将消息持久化到磁盘了&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;我们必须实现这样的一个效果，才能保证投递到MQ集群的数据是不会丢失的&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="185" y="4750" width="1260" height="320" as="geometry" />
        </mxCell>
        <mxCell id="nVV2XkVS_77D108Cf_11-2" value="&lt;ul class=&quot;list-paddingleft-2&quot; style=&quot;margin: 0px 8px; padding: 0px 0px 0px 2.2em; max-width: 100%; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;仓储服务那块到底是如何基于手动ack就可以实现数据不丢失的？&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;RabbitMQ底层实现的细节和原理到底是什么？&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;为什么仓储服务没发送ack就宕机了，RabbitMQ可以自动感知到他宕机了，然后自动重发消息给其他的仓储服务实例呢？&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="185" y="5140" width="980" height="110" as="geometry" />
        </mxCell>
        <mxCell id="nVV2XkVS_77D108Cf_11-3" value="生产者如何保证消息的不丢失" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontStyle=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="665" y="5370" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nVV2XkVS_77D108Cf_11-4" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;一个最大的问题，就是生产者投递出去的消息，可能会丢失。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;丢失的原因有很多，比如消息在网络传输到一半的时候因为网络故障就丢了，或者是消息投递到MQ的内存时，MQ突发故障宕机导致消息就丢失了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;针对这种生产者投递数据丢失的问题，RabbitMQ实际上是提供了一些机制的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如，有一种重量级的机制，就是&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;事务消息机制&lt;/strong&gt;。采用类事务的机制把消息投递到MQ，可以保证消息不丢失，但是性能极差，经过测试性能会呈现几百倍的下降。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以说现在一般是不会用这种过于重量级的机制，而是会用&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;轻量级的confirm机制&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;但是我们这篇文章还不能直接讲解生产者保证消息不丢失的confirm机制，因为这种confirm机制实际上是采用了类似消费者的ack机制来实现的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以，要深入理解confirm机制，我们得先从这篇文章开始，深入的分析一下消费者手动ack机制保证消息不丢失的底层原理。&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="185" y="5450" width="1250" height="490" as="geometry" />
        </mxCell>
        <mxCell id="nVV2XkVS_77D108Cf_11-5" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font color=&quot;#ff00ff&quot; style=&quot;font-size: 18px&quot;&gt;ack机制实现原理：delivery tag&lt;/font&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="145" y="6020" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-1" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果你写好了一个消费者服务的代码，让他开始从RabbitMQ消费数据，这时这个消费者服务实例就会自己注册到RabbitMQ。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以，RabbitMQ其实是知道有哪些消费者服务实例存在的。&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;接着，RabbitMQ就会通过自己内部的一个&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;“basic.delivery”&lt;/strong&gt;方法来投递消息到仓储服务里去，让他消费消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;投递的时候，会给这次消息的投递带上一个重要的东西，就是&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(201 , 56 , 28) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;“delivery tag”&lt;/strong&gt;&lt;/span&gt;，你可以认为是本次消息投递的一个&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(201 , 56 , 28) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;唯一标识&lt;/span&gt;&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这个所谓的唯一标识，有点类似于一个ID，比如说消息本次投递到一个仓储服务实例的唯一ID。通过这个唯一ID，我们就可以定位一次消息投递。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以这个delivery tag机制不要看很简单，实际上他是后面要说的很多机制的核心基础。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;而且这里要给大家强调另外一个概念，就是每个消费者从RabbitMQ获取消息的时候，都是通过一个channel的概念来进行的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;大家回看一下下面的消费者代码片段，我们必须是先对指定机器上部署的RabbitMQ建立连接，然后通过这个连接获取一个channel。&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;我们在仓储服务里对消息的消费、ack等操作，全部都是基于这个channel来进行的&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;span style=&quot;font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; background-color: rgb(255 , 255 , 255)&quot;&gt;你大概可以认为这个channel就是进行数据传输的一个管道吧。对于每个channel而言，一个“delivery tag”就可以唯一的标识一次消息投递，这个delivery tag大致而言就是一个不断增长的数字。&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="1" vertex="1">
          <mxGeometry x="140" y="6084.5" width="1500" height="690" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="565" y="6950" as="targetPoint" />
            <Array as="points">
              <mxPoint x="485" y="6830" />
              <mxPoint x="485" y="6950" />
              <mxPoint x="561" y="6950" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-3" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="275" y="6800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-5" target="0q1MMLpygY_Zd2AtGhnZ-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="475" y="6970" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-5" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="275" y="6940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-7" target="0q1MMLpygY_Zd2AtGhnZ-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="555" y="7000" as="targetPoint" />
            <Array as="points">
              <mxPoint x="485" y="7110" />
              <mxPoint x="485" y="6990" />
              <mxPoint x="555" y="6990" />
              <mxPoint x="555" y="6991" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-7" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="275" y="7080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-8" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="565" y="6905" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-12" target="0q1MMLpygY_Zd2AtGhnZ-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-12" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1002.5" y="6895" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-16" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-8" target="0q1MMLpygY_Zd2AtGhnZ-12" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="945" y="7010" as="sourcePoint" />
            <mxPoint x="995" y="6960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-21" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="405" y="6810" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-22" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="405" y="6950" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-23" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="405" y="7090" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-24" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="695" y="6905" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-25" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="585" y="6960" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-26" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="705" y="6960" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-28" target="0q1MMLpygY_Zd2AtGhnZ-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-28" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="585" y="7000" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-30" target="0q1MMLpygY_Zd2AtGhnZ-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-30" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="690" y="7000" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-31" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="795" y="7000" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-33" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1162.5" y="6940" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-39" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1285" y="6940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-41" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1025" y="6910" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-42" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1020" y="6984" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-43" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-39" target="0q1MMLpygY_Zd2AtGhnZ-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="940" y="6820" as="sourcePoint" />
            <mxPoint x="990" y="6770" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1345" y="6840" />
              <mxPoint x="713" y="6840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-44" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1015" y="6820" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-45" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果采用手动ack机制，实际上仓储服务每次消费了一条消息，处理完毕完成调度发货之后，就会发送一个ack消息给RabbitMQ服务器，这个ack消息是会带上自己本次消息的delivery tag的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;咱们看看下面的ack代码，是不是带上了一个delivery tag？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;channel.&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;basicAck&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;&amp;nbsp;delivery.getEnvelope().getDeliveryTag(),&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; letter-spacing: 0.621714px ; font-size: 14px&quot;&gt;&amp;nbsp;false);&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;然后，RabbitMQ根据哪个channel的哪个delivery tag，不就可以唯一定位一次消息投递了？&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="145" y="7230" width="1480" height="250" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-46" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;接下来就可以对那条消息删除，标识为已经处理完毕。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这里大家必须注意的一点，就是delivery tag仅仅在一个channel内部是唯一标识消息投递的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以说，你ack一条消息的时候，必须是通过接受这条消息的同一个channel来进行。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;大家看看下面的图，直观的感受一下。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="140" y="7530" width="740" height="250" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-48" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="7960" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="7840" />
              <mxPoint x="420" y="7960" />
              <mxPoint x="496" y="7960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-48" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="7810" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-50" target="0q1MMLpygY_Zd2AtGhnZ-53" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="410" y="7980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-50" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="7950" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-52" target="0q1MMLpygY_Zd2AtGhnZ-53" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="490" y="8010" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="8120" />
              <mxPoint x="420" y="8000" />
              <mxPoint x="490" y="8000" />
              <mxPoint x="490" y="8001" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-52" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="8090" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-53" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="7915" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-55" target="0q1MMLpygY_Zd2AtGhnZ-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-55" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="937.5" y="7905" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-56" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-53" target="0q1MMLpygY_Zd2AtGhnZ-55" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="880" y="8020" as="sourcePoint" />
            <mxPoint x="930" y="7970" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-57" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="7820" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-58" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="7960" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-59" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="8100" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-60" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="630" y="7915" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-61" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="7970" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-62" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="640" y="7970" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-64" target="0q1MMLpygY_Zd2AtGhnZ-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-64" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="8010" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-66" target="0q1MMLpygY_Zd2AtGhnZ-67" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-66" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="625" y="8010" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-67" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="730" y="8010" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-68" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1097.5" y="7950" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-69" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="7950" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-70" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="960" y="7920" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-71" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="955" y="7994" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-72" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-69" target="0q1MMLpygY_Zd2AtGhnZ-60" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875" y="7830" as="sourcePoint" />
            <mxPoint x="925" y="7780" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1280" y="7850" />
              <mxPoint x="648" y="7850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-73" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="950" y="7830" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-74" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-69" target="0q1MMLpygY_Zd2AtGhnZ-55" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1260" y="8110" as="sourcePoint" />
            <mxPoint x="1000" y="8070" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1280" y="8100" />
              <mxPoint x="1000" y="8100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-75" value="ACK" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1127.5" y="8100" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-76" value="" style="endArrow=classic;html=1;fontSize=16;entryX=0.779;entryY=1.023;entryDx=0;entryDy=0;exitX=0.324;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-55" target="0q1MMLpygY_Zd2AtGhnZ-53" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="8180" as="sourcePoint" />
            <mxPoint x="810" y="8130" as="targetPoint" />
            <Array as="points">
              <mxPoint x="978" y="8100" />
              <mxPoint x="757" y="8100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-77" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="810" y="8080" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-78" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;其实这里还有一个很重要的点，就是我们可以设置一个参数，然后就批量的发送ack消息给RabbitMQ，这样可以提升整体的性能和吞吐量。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如下面那行代码，把第二个参数设置为true就可以了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 14px ; color: rgb(255 , 169 , 0)&quot;&gt;channel.basicAck(&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px ; color: rgb(255 , 169 , 0)&quot;&gt;&amp;nbsp;delivery.getEnvelope().getDeliveryTag(),&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;letter-spacing: 0.621714px ; color: rgb(255 , 169 , 0) ; font-size: 14px&quot;&gt;&amp;nbsp; true);&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;看到这里，大家应该对这个ack机制的底层原理有了稍微进一步的认识了。起码是知道delivery tag是啥东西了，他是实现ack的一个底层机制。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;然后，我们再来简单回顾一下自动ack、手动ack的区别。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;实际上默认用自动ack，是非常简单的。RabbitMQ只要投递一个消息出去给仓储服务，那么他立马就把这个消息给标记为删除，因为他是不管仓储服务到底接收到没有，处理完没有的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以这种情况下，&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;性能很好，但是数据容易丢失&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果手动ack，那么就是必须等仓储服务完成商品调度发货以后，才会手动发送ack给RabbitMQ，此时RabbitMQ才会认为消息处理完毕，然后才会标记消息为删除。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样在发送ack之前，仓储服务宕机，&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;RabbitMQ会重发消息给另外一个仓储服务实例，&lt;/strong&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;保证数据不丢&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="140" y="8255" width="1420" height="620" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-79" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font style=&quot;font-size: 18px&quot; color=&quot;#ff00ff&quot;&gt;RabbitMQ如何感知到仓储服务实例宕机&lt;/font&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="155" y="8960" width="350" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-80" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果你的仓储服务实例接收到了消息，但是没有来得及调度发货，没有发送ack，此时他宕机了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;我们想一想就知道，RabbitMQ之前既然收到了仓储服务实例的注册，因此他们之间必然是建立有某种联系的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;一旦某个仓储服务实例宕机，那么RabbitMQ就必然会感知到他的宕机，而且对发送给他的还没ack的消息，都发送给其他仓储服务实例。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="145" y="9030" width="1060" height="180" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-81" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-82" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="9460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="380" y="9340" />
              <mxPoint x="380" y="9460" />
              <mxPoint x="456" y="9460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-82" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="9310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-83" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-84" target="0q1MMLpygY_Zd2AtGhnZ-87" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="370" y="9480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-84" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="9450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-85" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-86" target="0q1MMLpygY_Zd2AtGhnZ-87" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="9510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="380" y="9620" />
              <mxPoint x="380" y="9500" />
              <mxPoint x="450" y="9500" />
              <mxPoint x="450" y="9501" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-86" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="9590" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-87" value="" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="460" y="9415" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-88" value="&lt;b style=&quot;font-size: 14px&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="980" y="9240" width="155" height="170" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-89" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-90" target="0q1MMLpygY_Zd2AtGhnZ-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-90" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1015" y="9450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-91" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-92" target="0q1MMLpygY_Zd2AtGhnZ-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-92" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1015" y="9590" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-93" value="" style="endArrow=classic;html=1;entryX=-0.017;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" target="0q1MMLpygY_Zd2AtGhnZ-116" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="791" y="9460" as="sourcePoint" />
            <mxPoint x="920" y="9470" as="targetPoint" />
            <Array as="points">
              <mxPoint x="880" y="9460" />
              <mxPoint x="880" y="9268" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-94" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-87" target="0q1MMLpygY_Zd2AtGhnZ-90" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="840" y="9520" as="sourcePoint" />
            <mxPoint x="890" y="9470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-95" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-87" target="0q1MMLpygY_Zd2AtGhnZ-92" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="9480" as="sourcePoint" />
            <mxPoint x="890" y="9580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="880" y="9500" />
              <mxPoint x="880" y="9620" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-96" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1225" y="9590" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-97" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1215" y="9275" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-98" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1225" y="9450" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-99" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="300" y="9320" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-100" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="300" y="9460" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-101" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="300" y="9600" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-102" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="9415" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-103" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="9470" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-104" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="600" y="9470" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-105" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-106" target="0q1MMLpygY_Zd2AtGhnZ-108" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-106" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="9510" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-107" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-108" target="0q1MMLpygY_Zd2AtGhnZ-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-108" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="585" y="9510" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-109" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="690" y="9510" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-110" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="890" y="9270" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-111" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="890" y="9460" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-112" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="890" y="9600" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-113" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1145" y="9590" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-114" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1145" y="9450" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-115" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1155" y="9290" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-116" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1012.5" y="9260" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-117" value="仓库服务&lt;br&gt;是否成功&lt;br&gt;调度" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=14;align=center;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1020" y="9320" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-118" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;shadow=1;" parent="1" target="0q1MMLpygY_Zd2AtGhnZ-117" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1060" y="9280" as="sourcePoint" />
            <mxPoint x="1235" y="9370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-119" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-116" target="0q1MMLpygY_Zd2AtGhnZ-97" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1159" y="9270" />
              <mxPoint x="1159" y="9305" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-120" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.5;exitDx=0;exitDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-117" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="745" y="9370" as="sourcePoint" />
            <mxPoint x="525" y="9428" as="targetPoint" />
            <Array as="points">
              <mxPoint x="525" y="9360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-121" value="接收ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="480" y="9430" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-122" value="发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="665" y="9340" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-123" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.38;exitY=1.05;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-121" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="522" y="9449" as="sourcePoint" />
            <mxPoint x="517" y="9510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-124" value="标记删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="485" y="9480" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-125" value="" style="endArrow=classic;html=1;fontSize=14;exitX=-0.027;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-128" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="815" y="9470" as="sourcePoint" />
            <mxPoint x="705" y="9420" as="targetPoint" />
            <Array as="points">
              <mxPoint x="905" y="9400" />
              <mxPoint x="705" y="9400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-126" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1060" y="9395" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-127" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="990" y="9350" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-128" value="不发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="905" y="9390" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-129" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.991;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-117" target="0q1MMLpygY_Zd2AtGhnZ-128" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1060" y="9400" as="sourcePoint" />
            <mxPoint x="1016" y="9420" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-130" value="发现消费者宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="745" y="9380" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-131" value="" style="endArrow=classic;html=1;fontSize=14;entryX=-0.033;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-106" target="0q1MMLpygY_Zd2AtGhnZ-92" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="495" y="9670" as="sourcePoint" />
            <mxPoint x="1005" y="9640" as="targetPoint" />
            <Array as="points">
              <mxPoint x="520" y="9640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-132" value="未收到ACK&lt;br&gt;订单消息03重新消费" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="9620" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-133" value="磁盘文件" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;fontSize=14;align=center;strokeColor=#9673a6;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="580" y="9781" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-134" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.055;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-103" target="0q1MMLpygY_Zd2AtGhnZ-133" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="450" y="9780" as="sourcePoint" />
            <mxPoint x="500" y="9730" as="targetPoint" />
            <Array as="points">
              <mxPoint x="496" y="9795" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-135" value="持久化queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="9720" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-136" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-133" target="0q1MMLpygY_Zd2AtGhnZ-103" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="350" y="9900" as="sourcePoint" />
            <mxPoint x="400" y="9850" as="targetPoint" />
            <Array as="points">
              <mxPoint x="480" y="9825" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-137" value="重启时加载&lt;br&gt;queue信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="490" y="9830" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-138" value="" style="endArrow=none;html=1;fontSize=14;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.931;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;endFill=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-133" target="0q1MMLpygY_Zd2AtGhnZ-103" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="800" y="9840" as="sourcePoint" />
            <mxPoint x="850" y="9790" as="targetPoint" />
            <Array as="points">
              <mxPoint x="750" y="9795" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-139" value="" style="endArrow=none;html=1;fontSize=14;exitX=0.979;exitY=1.014;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;endFill=0;startArrow=classic;startFill=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-103" target="0q1MMLpygY_Zd2AtGhnZ-133" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="920" y="9850" as="sourcePoint" />
            <mxPoint x="970" y="9800" as="targetPoint" />
            <Array as="points">
              <mxPoint x="764" y="9825" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-140" value="重启时加载&lt;br&gt;message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="700" y="9830" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-141" value="持久化message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="635" y="9720" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-142" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: left ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font style=&quot;font-size: 18px&quot; color=&quot;#ff00ff&quot;&gt;仓储服务处理失败时的消息重发&lt;/font&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="145" y="9970" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-143" value="&lt;font color=&quot;#ff3333&quot; style=&quot;font-size: 17px&quot;&gt;&lt;span&gt;DeliverCallback deliverCallback = (consumerTag, delivery) -&amp;gt; {&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span&gt;try{&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; String message = new String(delivery.getBody(), &quot;UTF-8&quot;);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; System.olut.println(&quot;[x] 仓储服务接收到消息，准备执行调度发货的流程 &quot; + message);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp;}catch(Exception e){&lt;br&gt;&amp;nbsp; &amp;nbsp;// 异常处理 ....&lt;br&gt;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;}finaly{&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;System.out.printly(&quot;[x] 订单完成调度发货&quot;);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// 这就是核心代码，手动在代码里对RabbitMQ进行ack&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;channel.basicAck(delivery.getEnvenlope().getDeliveryTag(), false);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp;}&lt;/span&gt;&lt;br&gt;&lt;span&gt;};&lt;/span&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;labelBorderColor=none;fillColor=#fff2cc;" parent="1" vertex="1">
          <mxGeometry x="155" y="10060" width="680" height="290" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-144" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;假如说某个仓储服务实例处理某个消息失败了，此时会进入catch代码块，那么此时我们怎么办呢？难道还是直接ack消息吗？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;当然不是了，你要是还是ack，那会导致消息被删除，但是实际没有完成调度发货。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;这样的话，数据不是还是丢失了吗？因此，合理的方式是使用nack操作。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;就是通知RabbitMQ自己没处理成功消息，然后让RabbitMQ将这个消息再次投递给其他的仓储服务实例尝试去完成调度发货的任务。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;我们只要在catch代码块里加入下面的代码即可：&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;channel.&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;basicNack&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; letter-spacing: 0.621714px ; margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word ; font-size: 14px&quot;&gt;delivery.getEnvelope().getDeliveryTag(),&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(255 , 169 , 0) ; letter-spacing: 0.621714px ; font-size: 14px&quot;&gt;&amp;nbsp;true);&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;注意上面第二个参数是true，意思就是让RabbitMQ把这条消息重新投递给其他的仓储服务实例，因为自己没处理成功。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;你要是设置为false的话，就会导致RabbitMQ知道你处理失败，但是还是删除这条消息，这是不对的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-size: 17px ; letter-spacing: 0.621714px ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;同样，我们还是来一张图，大家一起来感受一下：&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; letter-spacing: 2px ; font-size: 15px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="147.5" y="10425" width="1030" height="620" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-145" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-146" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="11210" as="targetPoint" />
            <Array as="points">
              <mxPoint x="370" y="11090" />
              <mxPoint x="370" y="11210" />
              <mxPoint x="446" y="11210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-146" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="11060" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-147" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-148" target="0q1MMLpygY_Zd2AtGhnZ-151" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="11230" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-148" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="11200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-149" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-150" target="0q1MMLpygY_Zd2AtGhnZ-151" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="11260" as="targetPoint" />
            <Array as="points">
              <mxPoint x="370" y="11370" />
              <mxPoint x="370" y="11250" />
              <mxPoint x="440" y="11250" />
              <mxPoint x="440" y="11251" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-150" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="11340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-151" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="11165" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-152" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-153" target="0q1MMLpygY_Zd2AtGhnZ-167" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-153" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="895" y="11182.5" width="125" height="95" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-154" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-151" target="0q1MMLpygY_Zd2AtGhnZ-153" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="830" y="11270" as="sourcePoint" />
            <mxPoint x="880" y="11220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-155" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="11070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-156" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="11210" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-157" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="290" y="11350" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-158" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="580" y="11165" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-159" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="470" y="11220" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-160" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="590" y="11220" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-161" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-162" target="0q1MMLpygY_Zd2AtGhnZ-164" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-162" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="470" y="11260" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-163" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-164" target="0q1MMLpygY_Zd2AtGhnZ-165" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-164" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="575" y="11260" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-165" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="11260" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-166" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1050" y="11205" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-177" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;fontSize=16;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-167" target="0q1MMLpygY_Zd2AtGhnZ-176" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-167" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="11200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-168" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="922.5" y="11185" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-169" value="message&lt;br&gt;delivery_tag=2" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="915" y="11244" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-170" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-167" target="0q1MMLpygY_Zd2AtGhnZ-158" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="825" y="11080" as="sourcePoint" />
            <mxPoint x="875" y="11030" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1230" y="11100" />
              <mxPoint x="598" y="11100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-171" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="900" y="11080" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-172" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.989;entryY=0.914;entryDx=0;entryDy=0;shadow=1;entryPerimeter=0;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-167" target="0q1MMLpygY_Zd2AtGhnZ-153" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1210" y="11360" as="sourcePoint" />
            <mxPoint x="950" y="11320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1230" y="11270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-173" value="&lt;font color=&quot;#00cc00&quot;&gt;ACK&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1090" y="11249" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-174" value="" style="endArrow=classic;html=1;fontSize=16;entryX=1;entryY=0.75;entryDx=0;entryDy=0;shadow=1;" parent="1" target="0q1MMLpygY_Zd2AtGhnZ-151" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="885" y="11263" as="sourcePoint" />
            <mxPoint x="760" y="11380" as="targetPoint" />
            <Array as="points">
              <mxPoint x="880" y="11263" />
              <mxPoint x="800" y="11263" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-175" value="&lt;font color=&quot;#00cc00&quot;&gt;ACK&lt;br&gt;delivery_tag=2&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="775" y="11244" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-176" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1370" y="11200" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-178" value="&lt;font style=&quot;font-size: 12px&quot; color=&quot;#00cc00&quot;&gt;调度成功&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1295" y="11205" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-180" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;重新投递&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="810" y="11205" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-183" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1370" y="11336.75" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-184" value="&lt;font style=&quot;font-size: 12px&quot; color=&quot;#ff3333&quot;&gt;调度失败&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1295" y="11341.75" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-185" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;fontSize=16;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-186" target="0q1MMLpygY_Zd2AtGhnZ-183" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-186" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1170" y="11336.75" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-187" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.989;entryY=0.914;entryDx=0;entryDy=0;shadow=1;entryPerimeter=0;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-186" target="0q1MMLpygY_Zd2AtGhnZ-191" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1210" y="11496.75" as="sourcePoint" />
            <mxPoint x="950" y="11456.75" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1230" y="11406.75" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-188" value="&lt;font color=&quot;#ff0000&quot;&gt;NACK&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1085" y="11385.75" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-189" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-191" target="0q1MMLpygY_Zd2AtGhnZ-186" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-190" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="1047.5" y="11341.75" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-191" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="895" y="11319.25" width="125" height="95" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-192" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="922.5" y="11321.75" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-193" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="915" y="11380.75" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-194" value="" style="endArrow=classic;html=1;exitX=0.941;exitY=1.014;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;exitPerimeter=0;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-159" target="0q1MMLpygY_Zd2AtGhnZ-191" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="11366.75" as="sourcePoint" />
            <mxPoint x="880" y="11356.75" as="targetPoint" />
            <Array as="points">
              <mxPoint x="743" y="11367" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-195" value="&lt;font style=&quot;font-size: 12px&quot;&gt;首次投递&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="805" y="11341.75" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-196" value="&lt;font color=&quot;#ff3333&quot;&gt;NACK&lt;br&gt;delivery_tag=1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="1" vertex="1">
          <mxGeometry x="775" y="11380.75" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0q1MMLpygY_Zd2AtGhnZ-198" value="" style="endArrow=classic;html=1;shadow=1;fontSize=12;entryX=0.75;entryY=1;entryDx=0;entryDy=0;exitX=0.996;exitY=0.444;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="0q1MMLpygY_Zd2AtGhnZ-196" target="0q1MMLpygY_Zd2AtGhnZ-151" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="11440" as="sourcePoint" />
            <mxPoint x="640" y="11390" as="targetPoint" />
            <Array as="points">
              <mxPoint x="698" y="11399" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="8b3E6Feor6n0GGgPXdMt" name="消息中间件如何实现消费吞吐量的百倍优化">
    <mxGraphModel dx="1852" dy="1034" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="sVo--3T0ijmoXCc1OJXL-0" />
        <mxCell id="sVo--3T0ijmoXCc1OJXL-1" parent="sVo--3T0ijmoXCc1OJXL-0" />
        <mxCell id="RQ-epZgWrY-lR4IXGUf2-0" value="unack消息积压的问题" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontStyle=1;fontColor=#FF00FF;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="720" y="30" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="RQ-epZgWrY-lR4IXGUf2-1" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;首先，我们要给大家介绍一下RabbitMQ的&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;prefetch count&lt;/span&gt;这个概念。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;每个channel（其实对应了一个消费者服务实例，你大体可以这么来认为），RabbitMQ投递消息的时候，都是会带上本次消息投递的一个delivery tag的，唯一标识一次消息投递。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;然后，我们进行ack时，也会带上这个delivery tag，基于同一个channel进行ack，ack消息里会带上delivery tag让RabbitMQ知道是对哪一次消息投递进行了ack，此时就可以对那条消息进行删除了。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=20;fontColor=#FF00FF;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="80" y="120" width="1550" height="180" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-0" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="500" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="380" />
              <mxPoint x="440" y="500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-1" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="220" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-3" target="2yFlwJT3n80RL9N0hR2L-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-3" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="220" y="490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-5" target="2yFlwJT3n80RL9N0hR2L-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="660" />
              <mxPoint x="440" y="540" />
              <mxPoint x="500" y="540" />
              <mxPoint x="500" y="541" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-5" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="220" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-6" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="510" y="455" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-8" target="2yFlwJT3n80RL9N0hR2L-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-8" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="947.5" y="445" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-9" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-6" target="2yFlwJT3n80RL9N0hR2L-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="560" as="sourcePoint" />
            <mxPoint x="940" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-10" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="350" y="360" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-11" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="350" y="500" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-12" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="350" y="640" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-13" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="640" y="455" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-14" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="530" y="510" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-15" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="650" y="510" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-17" target="2yFlwJT3n80RL9N0hR2L-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-17" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="530" y="550" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-19" target="2yFlwJT3n80RL9N0hR2L-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-19" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="635" y="550" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-20" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="740" y="550" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-21" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="1107.5" y="490" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-22" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="1230" y="490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-23" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="970" y="460" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-24" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="965" y="534" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-25" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-22" target="2yFlwJT3n80RL9N0hR2L-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="885" y="370" as="sourcePoint" />
            <mxPoint x="935" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1290" y="390" />
              <mxPoint x="658" y="390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-26" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="960" y="370" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-27" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-22" target="2yFlwJT3n80RL9N0hR2L-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1270" y="650" as="sourcePoint" />
            <mxPoint x="1010" y="610" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1290" y="640" />
              <mxPoint x="1010" y="640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-28" value="ACK" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="1137.5" y="640" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-29" value="" style="endArrow=classic;html=1;fontSize=16;entryX=0.779;entryY=1.023;entryDx=0;entryDy=0;exitX=0.324;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" source="2yFlwJT3n80RL9N0hR2L-8" target="2yFlwJT3n80RL9N0hR2L-6" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="770" y="720" as="sourcePoint" />
            <mxPoint x="820" y="670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="988" y="640" />
              <mxPoint x="767" y="640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2yFlwJT3n80RL9N0hR2L-30" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" parent="sVo--3T0ijmoXCc1OJXL-1" vertex="1">
          <mxGeometry x="820" y="620" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-0" value="&lt;span style=&quot;color: rgb(51, 51, 51); font-size: 15px; letter-spacing: 2px; background-color: rgb(255, 255, 255);&quot;&gt;所以，对于每个channel而言（你就认为是针对每个消费者服务实例吧，比如一个仓储服务实例），其实都有一些处于unack状态的消息。&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="740" width="1050" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-1" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如RabbitMQ正在投递一条消息到channel，此时消息肯定是unack状态吧？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;然后仓储服务接收到一条消息以后，要处理这条消息需要耗费时间，此时消息肯定是unack状态吧？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;同时，即使你执行了ack之后，你要知道这个ack他默认是异步执行的，尤其如果你开启了批量ack的话，更是有一个延迟时间才会ack的，此时消息也是unack吧？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那么大家考虑一下，&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;RabbitMQ他能够无限制的不停给你的消费者服务实例推送消息吗？&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;明显是不能的，如果RabbitMQ给你的消费者服务实例推送的消息过多过快，比如都有几千条消息积压在某个消费者服务实例的内存中。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那么此时这几千条消息都是unack的状态，一直积压着，是不是有可能会导致消费者服务实例的内存溢出？内存消耗过大？甚至内存泄露之类的问题产生？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以说，RabbitMQ是必须要考虑一下消费者服务的处理能力的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;大家看看下面的图，感受一下如果消费者服务实例的内存中积压消息过多，都是unack的状态，此时会怎么样。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="810" width="1250" height="530" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-3" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="470" y="1530" as="targetPoint" />
            <Array as="points">
              <mxPoint x="400" y="1410" />
              <mxPoint x="400" y="1530" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-3" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="180" y="1380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-5" target="l4yiZMI0Lqiobq8qElfs-8" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="1550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-5" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="180" y="1520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-7" target="l4yiZMI0Lqiobq8qElfs-8" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="1580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="400" y="1690" />
              <mxPoint x="400" y="1570" />
              <mxPoint x="460" y="1570" />
              <mxPoint x="460" y="1571" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-7" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="180" y="1660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-8" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="470" y="1485" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-10" target="l4yiZMI0Lqiobq8qElfs-24" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-10" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="907.5" y="1475" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-11" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-8" target="l4yiZMI0Lqiobq8qElfs-10" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="850" y="1590" as="sourcePoint" />
            <mxPoint x="900" y="1540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-12" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="310" y="1390" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-13" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="310" y="1530" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-14" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="310" y="1670" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-15" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="600" y="1485" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-16" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="490" y="1540" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-17" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="610" y="1540" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-19" target="l4yiZMI0Lqiobq8qElfs-21" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-19" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="490" y="1580" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-21" target="l4yiZMI0Lqiobq8qElfs-22" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-21" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="595" y="1580" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-22" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="700" y="1580" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-23" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1067.5" y="1520" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-24" value="仓储服务&lt;br&gt;" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1187.5" y="1490" width="122.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-25" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="930" y="1490" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-26" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="925" y="1564" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-27" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-24" target="l4yiZMI0Lqiobq8qElfs-15" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="845" y="1400" as="sourcePoint" />
            <mxPoint x="895" y="1350" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1250" y="1420" />
              <mxPoint x="618" y="1420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-28" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="920" y="1400" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-29" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-24" target="l4yiZMI0Lqiobq8qElfs-10" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1230" y="1680" as="sourcePoint" />
            <mxPoint x="970" y="1640" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1250" y="1670" />
              <mxPoint x="970" y="1670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-30" value="ACK" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1097.5" y="1670" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-31" value="" style="endArrow=classic;html=1;fontSize=16;entryX=0.779;entryY=1.023;entryDx=0;entryDy=0;exitX=0.324;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryPerimeter=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-10" target="l4yiZMI0Lqiobq8qElfs-8" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="730" y="1750" as="sourcePoint" />
            <mxPoint x="780" y="1700" as="targetPoint" />
            <Array as="points">
              <mxPoint x="948" y="1670" />
              <mxPoint x="727" y="1670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-32" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="780" y="1650" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-33" value="积压几千个&lt;br&gt;unack message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1198.75" y="1570" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-34" value="&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; font-size: 20px; letter-spacing: 0.621714px; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 20px;&quot;&gt;如何解决unack消息的积压问题&lt;/span&gt;&lt;/strong&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontColor=#FF3333;fontSize=20;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="1815" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-35" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;正是因为这个原因，RabbitMQ基于一个&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;prefetch count&lt;/span&gt;来控制这个unack message的数量。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;你可以通过 “&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;channel.basicQos(10)&lt;/span&gt;” 这个方法来设置当前channel的prefetch count。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;举个例子，比如你要是设置为10的话，那么意味着当前这个channel里，unack message的数量不能超过10个，以此来避免消费者服务实例积压unack message过多。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样的话，就意味着RabbitMQ正在投递到channel过程中的unack message，以及消费者服务在处理中的unack message，以及异步ack之后还没完成ack的unack message，所有这些message加起来，一个channel也不能超过10个。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果你要简单粗浅的理解的话，也大致可以理解为这个prefetch count就代表了一个消费者服务同时最多可以获取多少个message来处理。所以这里也点出了prefetch这个单词的意思。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;prefetch就是预抓取的意思，就意味着你的消费者服务实例预抓取多少条message过来处理，但是最多只能同时处理这么多消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果一个channel里的unack message超过了prefetch count指定的数量，此时RabbitMQ就会停止给这个channel投递消息了，必须要等待已经投递过去的消息被ack了，此时才能继续投递下一个消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;老规矩，给大家上一张图，我们一起来看看这个东西是啥意思。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="1880" width="1830" height="530" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-80" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font style=&quot;font-size: 20px&quot;&gt;高并发场景下的内存溢出问题&lt;/font&gt;&lt;/span&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="3020" width="280" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-81" value="&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;好！现在大家对ack机制底层的另外一个核心机制：prefetch机制也有了一个深刻的理解了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时，咱们就应该来考虑一个问题了。就是&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;如何来设置这个prefetch count呢？这个东西设置的过大或者过小有什么影响呢？&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;其实大家理解了上面的图就很好理解这个问题了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;假如说我们把prefetch count设置的很大，比如说3000，5000，甚至100000，就这样特别大的值，那么此时会如何呢？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这个时候，在高并发大流量的场景下，可能就会导致消费者服务的内存被快速的消耗掉。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;因为假如说现在MQ接收到的流量特别的大，每秒都上千条消息，而且此时你的消费者服务的prefetch count还设置的特别大，就会导致可能一瞬间你的消费者服务接收到了达到prefetch count指定数量的消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;打个比方，比如一下子你的消费者服务内存里积压了10万条消息，都是unack的状态，反正你的prefetch count设置的是10万。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那么对一个channel，RabbitMQ就会最多容忍10万个unack状态的消息，在高并发下也就最多可能积压10万条消息在消费者服务的内存里。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那么此时导致的结果，就是消费者服务直接被击垮了，内存溢出，OOM，服务宕机，然后大量unack的消息会被重新投递给其他的消费者服务，此时其他消费者服务一样的情况，直接宕机，最后造成&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(201 , 56 , 28) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;雪崩效应&lt;/span&gt;&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所有的消费者服务因为扛不住这么大的数据量，全部宕机。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px; padding: 0px; max-width: 100%; clear: both; min-height: 1em; color: rgb(51, 51, 51); font-size: 17px; letter-spacing: 0.621714px; line-height: 2em; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;大家来看看下面的图，自己感受一下现场的氛围。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="3090" width="1610" height="740" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-83" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="410" y="4020" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="3900" />
              <mxPoint x="340" y="4020" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-83" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="120" y="3870" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-85" target="l4yiZMI0Lqiobq8qElfs-88" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="4040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-85" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="120" y="4010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-87" target="l4yiZMI0Lqiobq8qElfs-88" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="400" y="4070" as="targetPoint" />
            <Array as="points">
              <mxPoint x="340" y="4180" />
              <mxPoint x="340" y="4060" />
              <mxPoint x="400" y="4060" />
              <mxPoint x="400" y="4061" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-87" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="120" y="4150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-133" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;" edge="1" parent="sVo--3T0ijmoXCc1OJXL-1" source="l4yiZMI0Lqiobq8qElfs-88" target="l4yiZMI0Lqiobq8qElfs-117">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-88" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="410" y="3975" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-90" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1138.75" y="3975" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-92" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="250" y="3880" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-93" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="250" y="4020" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-94" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="250" y="4160" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-95" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="540" y="3975" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-96" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="430" y="4030" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-97" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="550" y="4030" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-99" target="l4yiZMI0Lqiobq8qElfs-101" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-99" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="430" y="4070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-100" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-101" target="l4yiZMI0Lqiobq8qElfs-102" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-101" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="535" y="4070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-102" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="640" y="4070" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-103" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1330" y="4020" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-105" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1168.75" y="3984.5" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-106" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1156.25" y="4060" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-107" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-127" target="l4yiZMI0Lqiobq8qElfs-95" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1188.75" y="3980" as="sourcePoint" />
            <mxPoint x="835" y="3840" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1539" y="3910.5" />
              <mxPoint x="558" y="3910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-108" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="860" y="3890" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-109" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" target="l4yiZMI0Lqiobq8qElfs-90" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1510" y="3980.5" as="sourcePoint" />
            <mxPoint x="910" y="3960" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1510" y="3930.5" />
              <mxPoint x="1201" y="3930.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-110" value="ACK" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1360" y="3930" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-111" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;exitX=0.316;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-90" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="888" y="3960" as="sourcePoint" />
            <mxPoint x="665" y="3974" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1178" y="3928.5" />
              <mxPoint x="665" y="3930" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-112" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="725" y="3910" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-114" value="prefetch count=10万" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;fontStyle=1" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1136.25" y="4010" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-117" value="" style="rhombus;whiteSpace=wrap;html=1;fontSize=12;fontColor=#FF3333;align=left;labelBackgroundColor=none;fillColor=none;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="850" y="3997.5" width="140" height="85" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-137" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;exitX=1.004;exitY=0.638;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="sVo--3T0ijmoXCc1OJXL-1" source="l4yiZMI0Lqiobq8qElfs-118">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1137" y="4040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-118" value="&lt;font style=&quot;font-size: 14px&quot;&gt;unack message&lt;br&gt;数量是否达到10万个&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="847.5" y="4014.5" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-119" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#FF3333;" edge="1" source="l4yiZMI0Lqiobq8qElfs-117" target="l4yiZMI0Lqiobq8qElfs-117" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-120" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-117" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="655" y="4150" as="sourcePoint" />
            <mxPoint x="705" y="4100" as="targetPoint" />
            <Array as="points">
              <mxPoint x="920" y="4188.5" />
              <mxPoint x="705" y="4188.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-121" value="&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;font color=&quot;#00ff00&quot; style=&quot;font-size: 14px&quot;&gt;是&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 14px&quot;&gt;不再投递&lt;/font&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF3333;labelBackgroundColor=none;" vertex="1" connectable="0" parent="l4yiZMI0Lqiobq8qElfs-120">
          <mxGeometry x="0.5857" relative="1" as="geometry">
            <mxPoint x="210" y="-76" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-124" value="" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1447.5" y="4248.5" width="122.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-125" value="积压10万个&lt;br&gt;unack message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1458.75" y="4309" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-126" value="内存溢出 宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1463.75" y="4348.5" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-127" value="" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1447.5" y="3984.5" width="122.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-128" value="积压10万个&lt;br&gt;unack message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1458.75" y="4043.5" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-129" value="内存溢出 宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1463.75" y="4085" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-130" value="&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;仓储服务&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1473.75" y="3994.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-132" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=1.018;exitY=0.457;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" edge="1" parent="sVo--3T0ijmoXCc1OJXL-1" source="l4yiZMI0Lqiobq8qElfs-90" target="l4yiZMI0Lqiobq8qElfs-127">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1440" y="4198.5" as="sourcePoint" />
            <mxPoint x="1490" y="4148.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-134" value="&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;仓储服务&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1478.75" y="4248.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-135" value="" style="endArrow=none;html=1;fontSize=12;fontColor=#FF3333;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.803;entryY=0.996;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;endFill=0;" edge="1" parent="sVo--3T0ijmoXCc1OJXL-1" source="l4yiZMI0Lqiobq8qElfs-124" target="l4yiZMI0Lqiobq8qElfs-88">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="4428.5" as="sourcePoint" />
            <mxPoint x="710" y="4338.5" as="targetPoint" />
            <Array as="points">
              <mxPoint x="675" y="4308.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-138" value="&lt;font color=&quot;#000000&quot; style=&quot;font-size: 14px;&quot;&gt;重新投递&lt;br style=&quot;font-size: 14px;&quot;&gt;10万条消息&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1005" y="4288.5" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-141" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-142" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="405" y="2670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="335" y="2550" />
              <mxPoint x="335" y="2670" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-142" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="115" y="2520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-143" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-144" target="l4yiZMI0Lqiobq8qElfs-148" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="315" y="2690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-144" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="115" y="2660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-145" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-146" target="l4yiZMI0Lqiobq8qElfs-148" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="395" y="2720" as="targetPoint" />
            <Array as="points">
              <mxPoint x="335" y="2830" />
              <mxPoint x="335" y="2710" />
              <mxPoint x="395" y="2710" />
              <mxPoint x="395" y="2711" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-146" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="115" y="2800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-147" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;" edge="1" source="l4yiZMI0Lqiobq8qElfs-148" target="l4yiZMI0Lqiobq8qElfs-171" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-148" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="405" y="2625" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-149" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1133.75" y="2625" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-150" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="245" y="2530" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-151" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="245" y="2670" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-152" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="245" y="2810" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-153" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="535" y="2625" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-154" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="425" y="2680" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-155" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="545" y="2680" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-156" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-157" target="l4yiZMI0Lqiobq8qElfs-159" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-157" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="425" y="2720" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-158" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-159" target="l4yiZMI0Lqiobq8qElfs-160" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-159" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="530" y="2720" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-160" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="635" y="2720" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-161" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1325" y="2670" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-162" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1163.75" y="2634.5" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-163" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1151.25" y="2710" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-164" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-177" target="l4yiZMI0Lqiobq8qElfs-153" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1183.75" y="2630" as="sourcePoint" />
            <mxPoint x="830" y="2490" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1534" y="2560.5" />
              <mxPoint x="553" y="2560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-165" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="855" y="2540" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-166" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" target="l4yiZMI0Lqiobq8qElfs-149" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1505" y="2630.5" as="sourcePoint" />
            <mxPoint x="905" y="2610" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1505" y="2580.5" />
              <mxPoint x="1196" y="2580.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-167" value="ACK" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1355" y="2580" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-168" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;exitX=0.316;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-149" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="883" y="2610" as="sourcePoint" />
            <mxPoint x="660" y="2624" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1173" y="2578.5" />
              <mxPoint x="660" y="2580" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-169" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="720" y="2560" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-170" value="prefetch count=10" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;fontStyle=1" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1136.25" y="2660" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-171" value="" style="rhombus;whiteSpace=wrap;html=1;fontSize=12;fontColor=#FF3333;align=left;labelBackgroundColor=none;fillColor=none;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="845" y="2647.5" width="140" height="85" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-172" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-171" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1132" y="2690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-173" value="&lt;font style=&quot;font-size: 14px&quot;&gt;unack message&lt;br&gt;数量是否达到10个&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="847.5" y="2664.5" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-174" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#FF3333;" edge="1" source="l4yiZMI0Lqiobq8qElfs-171" target="l4yiZMI0Lqiobq8qElfs-171" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-175" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-171" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="2800" as="sourcePoint" />
            <mxPoint x="700" y="2750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="915" y="2838.5" />
              <mxPoint x="700" y="2838.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-176" value="&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;font color=&quot;#00ff00&quot; style=&quot;font-size: 14px&quot;&gt;是&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 14px&quot;&gt;不再投递&lt;/font&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF3333;labelBackgroundColor=none;" vertex="1" connectable="0" parent="l4yiZMI0Lqiobq8qElfs-175">
          <mxGeometry x="0.5857" relative="1" as="geometry">
            <mxPoint x="210" y="-76" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-177" value="" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1442.5" y="2634.5" width="122.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-178" value="积压10个&lt;br&gt;unack message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1453.75" y="2693.5" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-180" value="&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;仓储服务&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1468.75" y="2644.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-181" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=1.018;exitY=0.457;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-149" target="l4yiZMI0Lqiobq8qElfs-177" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1435" y="2848.5" as="sourcePoint" />
            <mxPoint x="1485" y="2798.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-182" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font style=&quot;font-size: 22px&quot;&gt;低吞吐量问题&lt;/font&gt;&lt;/span&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;labelBackgroundColor=none;fontColor=#FF3333;fontStyle=1" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="4490" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-183" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px ; color: rgb(64 , 179 , 230)&quot;&gt;那么如果反过来呢，&lt;/span&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px ; color: rgb(64 , 179 , 230)&quot;&gt;我们要是把prefetch count设置的很小会如何呢？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如说我们把prefetch count设置为1？此时就必然会导致消费者服务的吞吐量极低。因为你即使处理完一条消息，执行ack了也是异步的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;给你举个例子，假如说你的prefetch count = 1，RabbitMQ最多投递给你1条消息处于unack状态。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此时比如你刚处理完这条消息，然后执行了ack的那行代码，结果不幸的是，ack需要异步执行，也就是需要100ms之后才会让RabbitMQ感知到。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;那么100ms之后RabbitMQ感知到消息被ack了，此时才会投递给你下一条消息！&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这就尴尬了，在这100ms期间，你的消费者服务是不是啥都没干啊？&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这不就直接导致了你的消费者服务处理消息的吞吐量可能下降10倍，甚至百倍，千倍，都有这种可能！&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;大家看看下面的图，感受一下低吞吐量的现场。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="4570" width="1130" height="530" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-184" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-185" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="378.75" y="5310" as="targetPoint" />
            <Array as="points">
              <mxPoint x="308.75" y="5190" />
              <mxPoint x="308.75" y="5310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-185" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="88.75" y="5160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-186" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-187" target="l4yiZMI0Lqiobq8qElfs-191" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="288.75" y="5330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-187" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="88.75" y="5300" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-188" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-189" target="l4yiZMI0Lqiobq8qElfs-191" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="368.75" y="5360" as="targetPoint" />
            <Array as="points">
              <mxPoint x="308.75" y="5470" />
              <mxPoint x="308.75" y="5350" />
              <mxPoint x="368.75" y="5350" />
              <mxPoint x="368.75" y="5351" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-189" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="88.75" y="5440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-190" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;" edge="1" source="l4yiZMI0Lqiobq8qElfs-191" target="l4yiZMI0Lqiobq8qElfs-214" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-191" value="" style="whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="378.75" y="5265" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-192" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1107.5" y="5265" width="125" height="150" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-193" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="218.75" y="5170" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-194" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="218.75" y="5310" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-195" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="218.75" y="5450" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-196" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="508.75" y="5265" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-197" value="" style="whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="398.75" y="5320" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-198" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="518.75" y="5320" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-199" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-200" target="l4yiZMI0Lqiobq8qElfs-202" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-200" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="398.75" y="5360" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-201" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-202" target="l4yiZMI0Lqiobq8qElfs-203" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-202" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="503.75" y="5360" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-203" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="608.75" y="5360" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-204" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1298.75" y="5310" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-205" value="channel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1137.5" y="5274.5" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-206" value="message&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1125" y="5350" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-207" value="" style="endArrow=classic;html=1;fontSize=16;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.257;entryY=-0.2;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" source="l4yiZMI0Lqiobq8qElfs-220" target="l4yiZMI0Lqiobq8qElfs-196" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1157.5" y="5270" as="sourcePoint" />
            <mxPoint x="803.75" y="5130" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1508" y="5190" />
              <mxPoint x="527" y="5190" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-208" value="注册自己" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="847.5" y="5170" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-209" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" target="l4yiZMI0Lqiobq8qElfs-192" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1478.75" y="5270.5" as="sourcePoint" />
            <mxPoint x="878.75" y="5250" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1478.75" y="5220.5" />
              <mxPoint x="1169.75" y="5220.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-210" value="ACK&lt;br&gt;异步延迟100ms" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1288.75" y="5200" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-211" value="" style="endArrow=classic;html=1;fontSize=16;shadow=1;exitX=0.316;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-192" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="856.75" y="5250" as="sourcePoint" />
            <mxPoint x="633.75" y="5264" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1146.75" y="5218.5" />
              <mxPoint x="633.75" y="5220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-212" value="ACK&lt;br&gt;delivery_tag=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="693.75" y="5200" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-213" value="prefetch count=1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;fontStyle=1" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1115" y="5300" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-214" value="" style="rhombus;whiteSpace=wrap;html=1;fontSize=12;fontColor=#FF3333;align=left;labelBackgroundColor=none;fillColor=none;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="818.75" y="5287.5" width="140" height="85" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-215" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF3333;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-214" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1106" y="5330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-216" value="&lt;font style=&quot;font-size: 14px&quot;&gt;unack message&lt;br&gt;数量是否达到1个&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="826.25" y="5304.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-217" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#FF3333;" edge="1" source="l4yiZMI0Lqiobq8qElfs-214" target="l4yiZMI0Lqiobq8qElfs-214" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-218" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-214" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="623.75" y="5440" as="sourcePoint" />
            <mxPoint x="673.75" y="5390" as="targetPoint" />
            <Array as="points">
              <mxPoint x="888.75" y="5478.5" />
              <mxPoint x="673.75" y="5478.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-219" value="&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;font color=&quot;#00ff00&quot; style=&quot;font-size: 14px&quot;&gt;是&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 14px&quot;&gt;不再投递&lt;/font&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF3333;labelBackgroundColor=none;" vertex="1" connectable="0" parent="l4yiZMI0Lqiobq8qElfs-218">
          <mxGeometry x="0.5857" relative="1" as="geometry">
            <mxPoint x="210" y="-76" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-220" value="" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1416.25" y="5274.5" width="122.5" height="120" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-221" value="处理完消息了" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1432.5" y="5338.5" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-222" value="&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;仓储服务&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1442.5" y="5284.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-223" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#FF3333;exitX=1.018;exitY=0.457;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;" edge="1" source="l4yiZMI0Lqiobq8qElfs-192" target="l4yiZMI0Lqiobq8qElfs-220" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1408.75" y="5488.5" as="sourcePoint" />
            <mxPoint x="1458.75" y="5438.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-224" value="&lt;font style=&quot;font-size: 14px ; line-height: 100%&quot;&gt;否&lt;br&gt;继续投递&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1015" y="4010" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-225" value="&lt;font style=&quot;font-size: 14px ; line-height: 100%&quot;&gt;否&lt;br&gt;100ms后感知到ack&lt;br&gt;再继续投递&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="965" y="5300" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-227" value="&lt;font style=&quot;font-size: 14px ; line-height: 100%&quot;&gt;否&lt;br&gt;继续投递&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="1027.5" y="2660" width="70" height="60" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-230" value="&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;font style=&quot;font-size: 22px&quot;&gt;合理的设置prefetch count&lt;/font&gt;&lt;/span&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="80" y="5660" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-231" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以鉴于上面两种极端情况，RabbitMQ官方给出的建议是&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;prefetch count一般设置在100~300之间&lt;/span&gt;。&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;也就是一个消费者服务最多接收到100~300个message来处理，允许处于unack状态。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这个状态下可以兼顾吞吐量也很高，同时也不容易造成内存溢出的问题。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;但是其实在我们的实践中，这个prefetch count大家完全是可以自己去压测一下的。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;比如说慢慢调节这个值，不断加大，观察高并发大流量之下，吞吐量是否越来越大，而且观察消费者服务的内存消耗，会不会OOM、频繁FullGC等问题。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="88.75" y="5750" width="1190" height="320" as="geometry" />
        </mxCell>
        <mxCell id="l4yiZMI0Lqiobq8qElfs-232" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;其实通过最近几篇文章，基本上已经把消息中间件的消费端如何保证数据不丢失这个问题剖析的较为深入和透彻了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果你是基于RabbitMQ来做消息中间件的话，消费端的代码里，必须考虑三个问题：&lt;strong style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;手动ack、处理失败的nack、prefetch count的合理设置&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这三个问题背后涉及到了各种机制：&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot; style=&quot;margin: 0px ; padding: 0px 0px 0px 2.2em ; max-width: 100% ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;自动ack机制&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;delivery tag机制&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;ack批量与异步提交机制&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;消息重发机制&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;手动nack触发消息重发机制&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;prefetch count过大导致内存溢出问题&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; clear: both ; min-height: 1em ; line-height: 2em&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;prefetch count过小导致吞吐量过低&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这些底层机制和问题，咱们都一步步分析清楚了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;所以到现在，单论消费端这块的数据不丢失技术方案，相信大家在面试的时候就可以有一整套自己的理解和方案可以阐述了。&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="sVo--3T0ijmoXCc1OJXL-1">
          <mxGeometry x="78.75" y="6200" width="1120" height="630" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="nmFP5XbfS1VYr7q1-Tmu" name="高并发场景下，如何保证生产者投递到消息中间件的消息不丢失？">
    <mxGraphModel dx="1852" dy="1034" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="T2TyvwEO37OJlChBjBgD-0" />
        <mxCell id="T2TyvwEO37OJlChBjBgD-1" parent="T2TyvwEO37OJlChBjBgD-0" />
        <mxCell id="ZSrQpoVfI_C4SjkDlqn0-0" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;消息中间件的&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(64 , 179 , 230) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;生产端&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; color: rgb(51 , 51 , 51) ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;，一起来&lt;/span&gt;&lt;/span&gt;看看如何保证投递到MQ的数据不丢失。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;如果投递出去的消息在网络传输过程中丢失，或者在RabbitMQ的内存中还没写入磁盘的时候宕机，都会导致生产端投递到MQ的数据丢失。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;而且丢失之后，生产端自己还感知不到，同时还没办法来补救。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;下面的图就展示了这个问题。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="170" width="1080" height="250" as="geometry" />
        </mxCell>
        <mxCell id="ZSrQpoVfI_C4SjkDlqn0-1" value="&lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot; style=&quot;margin: 0px 0px 14px; padding: 0px; font-size: 23px; line-height: 1.4; letter-spacing: 0.621714px;&quot;&gt;高并发场景下，如何保证生产者投递到消息中间件的消息不丢失？&lt;/h2&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=23;fontColor=#FF3333;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="515" y="50" width="700" height="50" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-0" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="410" y="710" as="targetPoint" />
            <Array as="points">
              <mxPoint x="330" y="590" />
              <mxPoint x="330" y="710" />
              <mxPoint x="406" y="710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-1" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-3" target="OCvMhO_ngMlDvEZJMHBb-6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-3" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-5" target="OCvMhO_ngMlDvEZJMHBb-6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="400" y="760" as="targetPoint" />
            <Array as="points">
              <mxPoint x="330" y="870" />
              <mxPoint x="330" y="750" />
              <mxPoint x="400" y="750" />
              <mxPoint x="400" y="751" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-5" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-6" value="" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="410" y="665" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-7" value="&lt;b style=&quot;font-size: 14px&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="930" y="490" width="155" height="170" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-9" target="OCvMhO_ngMlDvEZJMHBb-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-9" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="965" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-11" target="OCvMhO_ngMlDvEZJMHBb-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-11" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="965" y="840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-12" value="" style="endArrow=classic;html=1;entryX=-0.017;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" target="OCvMhO_ngMlDvEZJMHBb-35">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="741" y="710" as="sourcePoint" />
            <mxPoint x="870" y="720" as="targetPoint" />
            <Array as="points">
              <mxPoint x="830" y="710" />
              <mxPoint x="830" y="518" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-14" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-6" target="OCvMhO_ngMlDvEZJMHBb-11">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="740" y="730" as="sourcePoint" />
            <mxPoint x="840" y="830" as="targetPoint" />
            <Array as="points">
              <mxPoint x="830" y="750" />
              <mxPoint x="830" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-15" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1175" y="840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-16" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1165" y="525" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-17" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1175" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-18" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="250" y="570" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-19" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="250" y="710" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-20" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="250" y="850" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-21" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="540" y="665" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-22" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="430" y="720" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-23" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="550" y="720" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-25" target="OCvMhO_ngMlDvEZJMHBb-27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-25" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="430" y="760" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-27" target="OCvMhO_ngMlDvEZJMHBb-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-27" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="535" y="760" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-28" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="640" y="760" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-29" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="840" y="520" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-30" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e51400;shadow=1;strokeColor=#B20000;fontColor=#ffffff;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="840" y="710" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-31" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="840" y="850" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-32" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1095" y="840" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-33" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1095" y="700" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-34" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1105" y="540" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-35" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="962.5" y="510" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-36" value="仓库服务&lt;br&gt;是否成功&lt;br&gt;调度" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=14;align=center;strokeColor=#82b366;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="970" y="570" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-37" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" target="OCvMhO_ngMlDvEZJMHBb-36">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1010" y="530" as="sourcePoint" />
            <mxPoint x="1185" y="620" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-35" target="OCvMhO_ngMlDvEZJMHBb-16">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1109" y="520" />
              <mxPoint x="1109" y="555" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-39" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.5;exitDx=0;exitDy=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-36">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="695" y="620" as="sourcePoint" />
            <mxPoint x="475" y="678" as="targetPoint" />
            <Array as="points">
              <mxPoint x="475" y="610" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-40" value="接收ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="430" y="680" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-41" value="发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="615" y="590" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-42" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.38;exitY=1.05;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-40">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="472" y="699" as="sourcePoint" />
            <mxPoint x="467" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-43" value="标记删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="435" y="730" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-44" value="" style="endArrow=classic;html=1;fontSize=14;exitX=-0.027;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-47">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="765" y="720" as="sourcePoint" />
            <mxPoint x="655" y="670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="855" y="650" />
              <mxPoint x="655" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-45" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1010" y="645" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-46" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="940" y="600" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-47" value="不发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="855" y="640" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-48" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.991;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-36" target="OCvMhO_ngMlDvEZJMHBb-47">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1010" y="650" as="sourcePoint" />
            <mxPoint x="966" y="670" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-49" value="发现消费者宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="695" y="630" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-50" value="" style="endArrow=classic;html=1;fontSize=14;entryX=-0.033;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-25" target="OCvMhO_ngMlDvEZJMHBb-11">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="445" y="920" as="sourcePoint" />
            <mxPoint x="955" y="890" as="targetPoint" />
            <Array as="points">
              <mxPoint x="470" y="890" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-51" value="未收到ACK&lt;br&gt;订单消息03重新消费" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="540" y="870" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-52" value="磁盘文件" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;fontSize=14;align=center;strokeColor=#9673a6;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="530" y="1031" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-53" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.055;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-22" target="OCvMhO_ngMlDvEZJMHBb-52">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="1030" as="sourcePoint" />
            <mxPoint x="450" y="980" as="targetPoint" />
            <Array as="points">
              <mxPoint x="446" y="1045" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-54" value="持久化queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="450" y="970" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-55" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-52" target="OCvMhO_ngMlDvEZJMHBb-22">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="1150" as="sourcePoint" />
            <mxPoint x="350" y="1100" as="targetPoint" />
            <Array as="points">
              <mxPoint x="430" y="1075" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-56" value="重启时加载&lt;br&gt;queue信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="440" y="1080" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-57" value="" style="endArrow=none;html=1;fontSize=14;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.931;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;endFill=0;shadow=1;fontColor=#FF3333;labelBackgroundColor=none;strokeColor=#FF3333;strokeWidth=2;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-52" target="OCvMhO_ngMlDvEZJMHBb-22">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="750" y="1090" as="sourcePoint" />
            <mxPoint x="800" y="1040" as="targetPoint" />
            <Array as="points">
              <mxPoint x="700" y="1045" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-58" value="" style="endArrow=none;html=1;fontSize=14;exitX=0.979;exitY=1.014;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;endFill=0;startArrow=classic;startFill=1;shadow=1;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-22" target="OCvMhO_ngMlDvEZJMHBb-52">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="870" y="1100" as="sourcePoint" />
            <mxPoint x="920" y="1050" as="targetPoint" />
            <Array as="points">
              <mxPoint x="714" y="1075" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-59" value="重启时加载&lt;br&gt;message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="650" y="1080" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-60" value="持久化message&lt;br&gt;&lt;span style=&quot;color: rgb(255 , 51 , 51)&quot;&gt;没来得及&lt;/span&gt;&lt;br style=&quot;color: rgb(255 , 51 , 51)&quot;&gt;&lt;span style=&quot;color: rgb(255 , 51 , 51)&quot;&gt;持久化到磁盘&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="585" y="940" width="110" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-13" value="" style="endArrow=classic;html=1;exitX=0.625;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;exitPerimeter=0;strokeColor=#FF3333;strokeWidth=2;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="OCvMhO_ngMlDvEZJMHBb-28" target="OCvMhO_ngMlDvEZJMHBb-9">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="770" as="sourcePoint" />
            <mxPoint x="840" y="720" as="targetPoint" />
            <Array as="points">
              <mxPoint x="690" y="730" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OCvMhO_ngMlDvEZJMHBb-61" value="&lt;font style=&quot;font-size: 14px&quot;&gt;没来得及投递出去&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=23;fontColor=#FF3333;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="660" y="700" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-0" value="&lt;strong style=&quot;margin: 0px; padding: 0px; max-width: 100%; font-size: 22px; letter-spacing: 0.621714px; text-align: justify; box-sizing: border-box; overflow-wrap: break-word;&quot;&gt;&lt;span style=&quot;margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-size: 22px;&quot;&gt;保证投递消息不丢失的confirm机制&lt;/span&gt;&lt;/strong&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="1290" width="370" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-1" value="&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;其实要解决这个问题，相信大家看过之前的消费端ack机制之后，也都猜到了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;很简单，就是生产端（比如上图的订单服务）首先需要开启一个confirm模式，接着投递到MQ的消息，如果MQ一旦将消息持久化到磁盘之后，必须也要回传一个confirm消息给生产端。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样的话，如果生产端的服务接收到了这个confirm消息，就知道是已经持久化到磁盘了。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;否则如果没有接收到confirm消息，那么就说明这条消息半路可能丢失了，此时你就可以重新投递消息到MQ去，确保消息不要丢失。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;而且一旦你开启了confirm模式之后，每次消息投递也同样是有一个delivery tag的，也是起到唯一标识一次消息投递的作用。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;这样，MQ回传ack给生产端的时候，会带上这个delivery tag。你就知道具体对应着哪一次消息投递了，可以删除这条消息。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;此外，如果RabbitMQ接收到一条消息之后，结果内部出错发现无法处理这条消息，那么他会回传一个nack消息给生产端。此时你就会感知到这条消息可能处理有问题，你可以选择重新再次投递这条消息到MQ去。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;或者另一种情况，如果某条消息很长时间都没给你回传ack/nack，那可能是极端意外情况发生了，数据也丢了，你也可以自己重新投递消息到MQ去。&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;&lt;br style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 8px ; padding: 0px ; max-width: 100% ; clear: both ; min-height: 1em ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei ui&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 17px ; letter-spacing: 0.621714px ; text-align: justify ; line-height: 2em ; box-sizing: border-box ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;margin: 0px ; padding: 0px ; max-width: 100% ; box-sizing: border-box ; word-wrap: break-word ; font-size: 15px ; letter-spacing: 2px&quot;&gt;通过这套confirm机制，就可以实现生产端投递消息不会丢失的效果。大家来看看下面的图，一起来感受一下。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#FF3333;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="120" y="1380" width="1630" height="600" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-64" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-65" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="2280" as="targetPoint" />
            <Array as="points">
              <mxPoint x="450" y="2160" />
              <mxPoint x="450" y="2280" />
              <mxPoint x="526" y="2280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-65" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="240" y="2130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-67" target="LEUSSZYqISiTrDHhZDLJ-70" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="2300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-67" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="240" y="2270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-68" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-69" target="LEUSSZYqISiTrDHhZDLJ-70" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="2330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="450" y="2440" />
              <mxPoint x="450" y="2320" />
              <mxPoint x="520" y="2320" />
              <mxPoint x="520" y="2321" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-69" value="订单服务" style="whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="240" y="2410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-70" value="" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="530" y="2235" width="330" height="130" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-71" value="&lt;b style=&quot;font-size: 14px&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/b&gt;" style="whiteSpace=wrap;html=1;fillColor=#cdeb8b;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1050" y="2060" width="160" height="200" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-73" target="LEUSSZYqISiTrDHhZDLJ-80" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-73" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1085" y="2270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-74" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-75" target="LEUSSZYqISiTrDHhZDLJ-78" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-75" value="仓储服务" style="whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1085" y="2410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-76" value="" style="endArrow=classic;html=1;entryX=-0.017;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" target="LEUSSZYqISiTrDHhZDLJ-98" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="861" y="2280" as="sourcePoint" />
            <mxPoint x="990" y="2290" as="targetPoint" />
            <Array as="points">
              <mxPoint x="950" y="2280" />
              <mxPoint x="950" y="2088" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-77" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.006;exitY=0.646;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-70" target="LEUSSZYqISiTrDHhZDLJ-75" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="2300" as="sourcePoint" />
            <mxPoint x="960" y="2400" as="targetPoint" />
            <Array as="points">
              <mxPoint x="950" y="2320" />
              <mxPoint x="950" y="2440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-78" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1295" y="2410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-79" value="仓库服务" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1285" y="2095" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-80" value="仓库系统" style="whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1295" y="2270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-81" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="370" y="2140" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-82" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="370" y="2280" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-83" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="370" y="2420" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-84" value="RabbitMQ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="660" y="2235" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-85" value="" style="whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="550" y="2290" width="290" height="70" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-86" value="queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="670" y="2290" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-87" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-88" target="LEUSSZYqISiTrDHhZDLJ-90" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-88" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="550" y="2330" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-89" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-90" target="LEUSSZYqISiTrDHhZDLJ-91" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-90" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="655" y="2330" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-91" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#6a00ff;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="760" y="2330" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-92" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="960" y="2090" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-93" value="订单消息01" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="960" y="2280" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-94" value="订单消息02" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#e1d5e7;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="960" y="2420" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-95" value="订单02&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1215" y="2410" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-96" value="订单01&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1215" y="2270" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-97" value="订单03&lt;br&gt;调度发货" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1225" y="2110" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-98" value="订单消息03" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e1d5e7;strokeColor=#9673a6;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1082.5" y="2080" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-99" value="仓库服务&lt;br&gt;是否成功&lt;br&gt;调度" style="rhombus;whiteSpace=wrap;html=1;fillColor=#d5e8d4;fontSize=14;align=center;strokeColor=#82b366;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1090" y="2140" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-100" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;shadow=1;" edge="1" target="LEUSSZYqISiTrDHhZDLJ-99" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1130" y="2100" as="sourcePoint" />
            <mxPoint x="1305" y="2190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-101" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-98" target="LEUSSZYqISiTrDHhZDLJ-79" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1229" y="2090" />
              <mxPoint x="1229" y="2125" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-102" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.5;exitDx=0;exitDy=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-99" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="815" y="2190" as="sourcePoint" />
            <mxPoint x="595" y="2248" as="targetPoint" />
            <Array as="points">
              <mxPoint x="595" y="2180" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-103" value="接收ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="550" y="2250" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-104" value="发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="820" y="2160" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-105" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.38;exitY=1.05;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-103" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="592" y="2269" as="sourcePoint" />
            <mxPoint x="587" y="2330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-106" value="标记删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="555" y="2300" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-107" value="" style="endArrow=classic;html=1;fontSize=14;exitX=-0.027;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-110" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="885" y="2290" as="sourcePoint" />
            <mxPoint x="775" y="2240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="975" y="2220" />
              <mxPoint x="775" y="2220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-109" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1060" y="2170" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-110" value="不发送ACK消息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="960" y="2210" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-111" value="" style="endArrow=classic;html=1;fontSize=14;entryX=0.991;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;exitX=0.167;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-108" target="LEUSSZYqISiTrDHhZDLJ-110" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1130" y="2220" as="sourcePoint" />
            <mxPoint x="1086" y="2240" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1100" y="2240" />
              <mxPoint x="1100" y="2221" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-112" value="发现消费者宕机" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#ffcc99;strokeColor=#36393d;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="815" y="2200" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-113" value="" style="endArrow=classic;html=1;fontSize=14;entryX=-0.033;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-88" target="LEUSSZYqISiTrDHhZDLJ-75" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="565" y="2490" as="sourcePoint" />
            <mxPoint x="1075" y="2460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="590" y="2460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-114" value="未收到ACK&lt;br&gt;订单消息03重新消费" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#60a917;strokeColor=#2D7600;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="660" y="2440" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-115" value="磁盘文件" style="whiteSpace=wrap;html=1;fillColor=#e1d5e7;fontSize=14;align=center;strokeColor=#9673a6;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="650" y="2601" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-116" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0.055;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-85" target="LEUSSZYqISiTrDHhZDLJ-115" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="2600" as="sourcePoint" />
            <mxPoint x="570" y="2550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="566" y="2615" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-117" value="持久化queue" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="570" y="2540" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-118" value="" style="endArrow=classic;html=1;fontSize=14;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-115" target="LEUSSZYqISiTrDHhZDLJ-85" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="2720" as="sourcePoint" />
            <mxPoint x="470" y="2670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="550" y="2645" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-119" value="重启时加载&lt;br&gt;queue信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="560" y="2650" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-120" value="" style="endArrow=none;html=1;fontSize=14;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.931;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;endFill=0;shadow=1;fontColor=#FF3333;labelBackgroundColor=none;strokeWidth=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-115" target="LEUSSZYqISiTrDHhZDLJ-85" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="870" y="2660" as="sourcePoint" />
            <mxPoint x="920" y="2610" as="targetPoint" />
            <Array as="points">
              <mxPoint x="820" y="2615" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-121" value="" style="endArrow=none;html=1;fontSize=14;exitX=0.979;exitY=1.014;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;endFill=0;startArrow=classic;startFill=1;shadow=1;" edge="1" source="LEUSSZYqISiTrDHhZDLJ-85" target="LEUSSZYqISiTrDHhZDLJ-115" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="2670" as="sourcePoint" />
            <mxPoint x="1040" y="2620" as="targetPoint" />
            <Array as="points">
              <mxPoint x="834" y="2645" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-122" value="重启时加载&lt;br&gt;message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="770" y="2650" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-123" value="持久化message" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="705" y="2530" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-124" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;shadow=1;strokeWidth=1;" edge="1" target="LEUSSZYqISiTrDHhZDLJ-73" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="820" y="2328" as="sourcePoint" />
            <mxPoint x="960" y="2290" as="targetPoint" />
            <Array as="points">
              <mxPoint x="820" y="2300" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-126" value="" style="endArrow=classic;html=1;labelBackgroundColor=none;strokeColor=#000000;strokeWidth=1;fontSize=22;fontColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="LEUSSZYqISiTrDHhZDLJ-99" target="LEUSSZYqISiTrDHhZDLJ-108">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1360" y="2240" as="sourcePoint" />
            <mxPoint x="1410" y="2190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-108" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;fillColor=#e51400;strokeColor=#B20000;fontColor=#ffffff;shadow=1;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="1115" y="2230" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-127" value="订单消息01&lt;br&gt;ack&lt;br&gt;delivery tag" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;strokeColor=#001DBC;fontColor=#ffffff;fillColor=#6666FF;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="505" y="2060" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-128" value="" style="endArrow=classic;html=1;labelBackgroundColor=none;strokeWidth=2;fontSize=16;fontColor=#000000;entryX=1.02;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.4;exitY=-0.1;exitDx=0;exitDy=0;exitPerimeter=0;strokeColor=#6666FF;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1" source="LEUSSZYqISiTrDHhZDLJ-91" target="LEUSSZYqISiTrDHhZDLJ-127">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="670" y="2110" as="sourcePoint" />
            <mxPoint x="720" y="2060" as="targetPoint" />
            <Array as="points">
              <mxPoint x="792" y="2090" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-130" value="" style="endArrow=classic;html=1;labelBackgroundColor=none;strokeWidth=2;fontSize=16;fontColor=#000000;strokeColor=#6666FF;" edge="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="2090" as="sourcePoint" />
            <mxPoint x="310" y="2128" as="targetPoint" />
            <Array as="points">
              <mxPoint x="310" y="2090" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="LEUSSZYqISiTrDHhZDLJ-131" value="回传ack 确认" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=16;fontColor=#000000;" vertex="1" parent="T2TyvwEO37OJlChBjBgD-1">
          <mxGeometry x="350" y="2070" width="110" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
